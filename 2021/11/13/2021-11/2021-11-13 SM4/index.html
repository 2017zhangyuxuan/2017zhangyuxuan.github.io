<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Zhang Yuxuan"><meta name="keywords" content=""><meta name="description" content="国密是国家密码局认定的国产密码算法，其中SM4是国密中的分组加密算法。本文将介绍SM4算法的加密和解密过程，并使用C++进行代码实现。"><meta property="og:type" content="article"><meta property="og:title" content="SM4算法介绍与代码实现"><meta property="og:url" content="https://2017zhangyuxuan.github.io/2021/11/13/2021-11/2021-11-13%20SM4/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="国密是国家密码局认定的国产密码算法，其中SM4是国密中的分组加密算法。本文将介绍SM4算法的加密和解密过程，并使用C++进行代码实现。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/hexo_img/%E5%AF%86%E7%A0%81%E5%AD%A65.jpeg"><meta property="article:published_time" content="2021-11-13T06:54:19.000Z"><meta property="article:modified_time" content="2023-12-17T09:07:50.564Z"><meta property="article:author" content="Zhang Yuxuan"><meta property="article:tag" content="SM4"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/hexo_img/%E5%AF%86%E7%A0%81%E5%AD%A65.jpeg"><title>SM4算法介绍与代码实现 - Hexo</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.15.6/katex.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"2017zhangyuxuan.github.io",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:40,cursorChar:"",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:"41ea7ec25546b456fd8c769b77c5f7b8",google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"y5CeAktdcKSzcAmVadWC9kvO-gzGzoHsz",app_key:"6DumtsnWAqBVLRmOTnmYxXx6",server_url:"https://y5ceaktd.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>var _hmt;Fluid.ctx.dnt||(_hmt=_hmt||[],function(){var t=document.createElement("script"),e=(t.src="https://hm.baidu.com/hm.js?41ea7ec25546b456fd8c769b77c5f7b8",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}())</script><meta name="generator" content="Hexo 7.0.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>KingOfDark</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/hexo_img/yourname6.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="SM4算法介绍与代码实现"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-11-13 14:54" pubdate>2021年11月13日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i>1.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i>6 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">SM4算法介绍与代码实现</h1><p id="updated-time" class="note note-info">本文最后更新于：2023年12月17日 下午</p><div class="markdown-body"><h1 id="SM4算法介绍"><a href="#SM4算法介绍" class="headerlink" title="SM4算法介绍"></a>SM4算法介绍</h1><h2 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h2><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111131454563.(null)" srcset="/img/loading.gif" lazyload alt="SM4加密过程"></p><ul><li>首先左侧描述了SM4加密的整体流程：</li></ul><ol><li>输入的一个消息分组为128bits，划分成4个小块，每个小块32bits</li><li>这四个小块经过32轮加密处理</li><li>加密处理后，再经过一次Permutation置换，得到最终加密结果</li></ol><ul><li>右侧描述其中一轮的加密过程，其他轮函数加密过程是类似的，只是轮密钥不同：</li></ul><ol><li>X_3 先后跟 X_2 、X_1 进行异或 —— ①</li><li>① 得到的结果再与轮密钥 RK_i 进行异或 —— ②</li><li>② 得到的记过为32bits，再分成4组8bits，每一组8bits 使用相同的S-Box进行替换，得到新的8bits —— ③</li><li>③ 得到的4组8bits重新拼接得到32bits，将这32bits复制成5份输入，第1份循环左移2位，第2份循环左移10位，第3份循环左移18位，第4份循环左移24位，第5份不改动直接输出 —— ④</li><li>④ 的得到的5份输出的32bits与X_0 一起进行异或 —— ⑤</li><li>最终得到输出 X’_3 就是 ⑤ 的输出，其他输出X’_0 &#x3D; X_1 ， X’_1 &#x3D; X_2， X’_2 &#x3D; X_3</li></ol><p>用公式进行描述如下所示，其中S代表使用S-box进行替换，L表示线性函数执行循环左移的操作</p><p>$$<br>X’_0 &#x3D; X_1 \<br>X’_1 &#x3D; X_2	\<br>X’_2 &#x3D; X_3<br>$$</p><p>$$<br>X’_3 &#x3D;X_0⊕ L( S (X_3 ⊕ X_2 ⊕ X_1 ⊕ RK_i))<br>$$<br>$$<br>A&#x3D;(a_0,a_1,a_2,a_3), B&#x3D;(b_0,b_1,b_2,b_3) \ (b_0,b_1,b_2,b_3) &#x3D; S(A)&#x3D; (Sbox(a_0),Sbox(a_1),Sbox(a_2),Sbox(a_3))<br>$$<br>$$<br>B&#x3D;(b_0,b_1,b_2,b_3), C (32bits) \ C &#x3D; L(B) &#x3D; B ⊕ (B&lt;&lt;2) ⊕(B&lt;&lt;10) ⊕(B&lt;&lt;18)⊕(B&lt;&lt;24)<br>$$</p><p class="note note-success">通过观察SM4加密过程可以看到，在一轮加密中，有3个输出完全等同于3个输入，只有一个输出需要经过一些复杂操作，即计算X'_3，所以在进行解密时，只需要计算原来的X_0，而这可以通过现有的输出得到的（具体操作见下面的解密过程）。</p><h2 id="解密过程"><a href="#解密过程" class="headerlink" title="解密过程"></a>解密过程</h2><ul><li>在了解了SM4一轮的加密过程后，不难得出一轮的解密过程，如下图所示</li></ul><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111131519980.png" srcset="/img/loading.gif" lazyload alt="SM4解密过程"></p><ul><li>同样左侧描述了SM4解密的整体流程：</li></ul><ol><li>输入的一个密文C为128bits，划分成4个小块，每个小块32bits</li><li>对这四个小块经过一次Permutation置换</li><li>对置换结果进行32轮类似的解密处理，得到最终的明文输出</li></ol><ul><li>具体描述一轮的解密过程，进行32轮类似的解密操作，其中X’_0对应加密过程中的输入X_1，X’_1对应输入X_2，X’_2对应输入X_3，所以重点计算得到原来输入的X_0，下面直接用公式来表示计算过程</li></ul><p>$$<br>X_1 &#x3D; X’_0 \qquad X_2 &#x3D; X’_1 \qquad X_3 &#x3D; X’_2<br>$$</p><p>$$<br>X_0 &#x3D;X’_3⊕ L( S (X’_2 ⊕ X’_1 ⊕ X’_0 ⊕ RK_i))<br>$$</p><p><strong>其中L线性函数跟S-box置换 都跟加密过程中一致；但需要注意的是解密过程中，轮密钥的使用次序是（31, 30, …, 1,0），跟加密过程使用的轮密钥次序正好是相反的</strong></p><h2 id="轮密钥生成"><a href="#轮密钥生成" class="headerlink" title="轮密钥生成"></a>轮密钥生成</h2><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111131454839.(null)" srcset="/img/loading.gif" lazyload alt="轮密钥生成"></p><ul><li>轮密钥生成过程如上图所示，其中K代表的是16字节的密钥，公式里的S用的和加密过程中相同的Sbox</li></ul><h1 id="C-实现SM4加密与解密"><a href="#C-实现SM4加密与解密" class="headerlink" title="C++实现SM4加密与解密"></a>C++实现SM4加密与解密</h1><h2 id="实现目标"><a href="#实现目标" class="headerlink" title="实现目标"></a>实现目标</h2><ol><li>使用C++实现SM4算法的加密和结果，实现包括ECB、CBC两种加密模式。并提供命令⾏接⼝对⼆进制⽂件 进⾏加&#x2F;解密。</li><li>实现对png图像文件的加密，只对图像数据部分进行加密，使得对加密png文件后仍能以png格式打开</li></ol><h2 id="命令行格式说明"><a href="#命令行格式说明" class="headerlink" title="命令行格式说明"></a>命令行格式说明</h2><ul><li>生成的二进制可执行文件为 AppliedCryptography，共有以下几种可选配置<ul><li>-enc：进行加密操作</li><li>-dec：进行解密操作</li><li>-mode：指定加密&#x2F;解密操作，其后跟着ecb或者cbc（如果没有指定，默认为ecb模式）</li><li>-png：指定输入和输出文件为png格式（对png文件做特殊处理，只加密数据块部分）；如果指定了，请保证文件的后缀名以.png格式结尾</li><li>-in：输入文件的路径，请使用相对路径</li><li>-out：输出文件的路径，请使用相对路径</li><li>-key：指定密钥，默认为”123456”</li><li>-iv：指定初始化向量，默认为”123456”</li><li>-test：如果指定了，执行测试函数</li></ul></li></ul><p class="note note-warning">1. 配置的命令请用小写<br>2. 一些配置之后请紧跟对应的参数值<br>3. 输入和输出的路径请用相对路径<br></p><ul><li>参考的测试命令如下</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">测试cbc模式加密png文件</span><br>./AppliedCryptography -enc -mode cbc -png -in logo.png -out test.png -iv 123456 -key 123456<br>./AppliedCryptography -dec -mode cbc -png -in test.png -out dec_test.png -iv 123456 -key 123456<br><span class="hljs-meta prompt_"># </span><span class="language-bash">测试ecb加密文件</span><br>./AppliedCryptography -enc -mode ecb -in test.txt -out ecb_test.txt -iv 123456 -key 123456<br>./AppliedCryptography -dec -mode ecb -in ecb_test.txt -out dec_test.txt -iv 123456 -key 123456<br></code></pre></td></tr></table></figure><h2 id="代码结构说明"><a href="#代码结构说明" class="headerlink" title="代码结构说明"></a>代码结构说明</h2><p>首先说明进行代码目录的说明，如下图所示：</p><center><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111131454890.(null)" srcset="/img/loading.gif" lazyload width="40%" height="40%"></center><p align="middle"><font size="2" color="grey">代码目录结构</font></p><ul><li>项目使用CMake 构建，build目录是构建目录，build&#x2F;output&#x2F;bin下是对应可执行文件的输出目录，build&#x2F;output&#x2F;bin&#x2F;test 目录下存放测试用的相关文件</li><li>Cmake-build-debug：使用CLion 编译构建时生成的目录</li><li>FirstWork：主要目录，sm4对应源代码是算法的具体实现；test对应的是测试相关方法，主要用于测试算法的正确性</li><li>hash-library：一个简单的第三方库，封装了hash操作和hex编码和解码等操作</li><li>util：其中util是一个工具类，主要封装了一些辅助函数</li><li>main.cpp：程序入口，主要实现了解析命令行参数，执行对应的操作</li></ul><h2 id="实现相关说明"><a href="#实现相关说明" class="headerlink" title="实现相关说明"></a>实现相关说明</h2><ul><li><p>在<code>sm4.h</code>和<code>sm4.cpp</code>中实现了SM4算法，具体实现逻辑只要是拆分成多个子函数</p><ul><li>L线性函数和Sbox替换函数实现</li><li>轮密钥生成</li><li><code>SM4EncRound</code>和<code>SM4DecRound</code>实现一轮的加密和解密</li><li><code>Encryption</code>和<code>Decryption</code>实现128bits输入的加密和解密</li><li><code>EncFile</code>和<code>DecFile</code>实现文件的加密和解密</li><li><code>EncPNG</code>和<code>DecPNG</code>实现对png格式文件的加密和解密</li></ul></li><li><p>需要注意的是，png图片文件，有自己的固定格式，主要为头部8字节固定签名，加其他数据块的结构，所以解析时要得到真正的数据块（IDAT)，对这一部分进行加密，这样才能加密后依然能够以png方式打开，具体的PNG格式参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/einsteinlike/article/details/41803193">PNG格式说明</a></p></li><li><p>测试函数主要有4个</p><ul><li><code>TestAll()</code> ：进行所有测试</li><li><code>TestEncDec()</code>： 测试SM4 单次加解密128bits</li><li><code>TestEncDecFileECB()</code>： 测试SM4 加密和解密文件 ECB模式</li><li><code>TestEncDecFileCBC()</code>： 测试SM4 加密和解密文件 CBC模式</li><li><code>TestEncDecPNG()</code>： 测试SM4 加密和解密PNG图片</li></ul></li></ul><p class="note note-info">代码已上传Github仓库：https://github.com/2017zhangyuxuan/AppliedCryptography<br></p><p class="note note-danger">但是当前代码还存在问题是，大端和小端的问题没有彻底解决，如果对比一些官方实现，加密结果是不同的，因为时间原因没有能排查出来，只能作罢。所以仅仅是提供一些思路。</p><center><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/hexo_img/菜狗.jpeg" srcset="/img/loading.gif" lazyload width="40%" height="40%" align="middle"></center><h1 id="参考附录"><a href="#参考附录" class="headerlink" title="参考附录"></a>参考附录</h1><p>SM4算法原理 ：<a target="_blank" rel="noopener" href="https://blog.csdn.net/bird_tp/article/details/105988468">https://blog.csdn.net/bird_tp/article/details/105988468</a></p><p>SM4 实现参考：<a target="_blank" rel="noopener" href="https://cryptopp.com/docs/ref/class_s_m4_1_1_base.html#details">https://cryptopp.com/docs/ref/class_s_m4_1_1_base.html#details</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39672443/article/details/110806799">png文件头_图片格式知识PNG_weixin_39672443的博客-CSDN博客</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/einsteinlike/article/details/41803193">PNG格式说明</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/" class="category-chain-item">计算机知识</a> <span>></span> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/%E5%AF%86%E7%A0%81%E5%AD%A6/" class="category-chain-item">密码学</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/SM4/" class="print-no-link">#SM4</a></div></div><div class="license-box my-3"><div class="license-title"><div>SM4算法介绍与代码实现</div><div>https://2017zhangyuxuan.github.io/2021/11/13/2021-11/2021-11-13 SM4/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Zhang Yuxuan</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2021年11月13日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2021/11/27/2021-11/2021-11-27%20%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%93%E9%A2%9804-%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%AF%86%E7%A0%81%E7%AE%97%E6%B3%95%E5%9C%A8%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" title="【比特币专题04】椭圆曲线密码算法在比特币中的应用"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">【比特币专题04】椭圆曲线密码算法在比特币中的应用</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2021/11/13/2021-11/2021-11-13%20%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%93%E9%A2%9803-%E9%9A%94%E7%A6%BB%E8%A7%81%E8%AF%81%E3%80%81%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C/" title="【比特币专题03】隔离见证、闪电网络"><span class="hidden-mobile">【比特币专题03】隔离见证、闪电网络</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="waline"></div><script>Fluid.utils.loadComments("#waline",function(){Fluid.utils.createCssLink("https://lib.baomitu.com/waline/2.5.1/waline.min.css"),Fluid.utils.createScript("https://lib.baomitu.com/waline/2.5.1/waline.min.js",function(){var i=Object.assign({serverURL:"https://blog-api-cwpbgt9h8-2017zhangyuxuan.vercel.app",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10,placeholder:"期待地搓搓手~",avatar:"mp",avatarCDN:"https://seccdn.libravatar.org/avatar/",avatarForce:!1,highlight:!0},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">浙ICP备2022004380号-1 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011502005551" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备11011502005551号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>