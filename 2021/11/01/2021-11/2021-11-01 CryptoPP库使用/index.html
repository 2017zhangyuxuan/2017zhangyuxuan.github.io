<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="在比特币系统中使用了大量哈希加密、签名验证等操作，为了用代码来模拟实现比特币的运行过程，学习一个支持密码原语操作的第三方库是非常有必要的。本文将介绍CryptoPP第三方库的相关使用方法，并展示具体的代码实现。"><meta name="author" content="Zhang Yuxuan"><meta name="keywords" content=""><meta name="description" content="在比特币系统中使用了大量哈希加密、签名验证等操作，为了用代码来模拟实现比特币的运行过程，学习一个支持密码原语操作的第三方库是非常有必要的。本文将介绍CryptoPP第三方库的相关使用方法，并展示具体的代码实现。"><meta property="og:type" content="article"><meta property="og:title" content="CryptoPP C++库学习使用"><meta property="og:url" content="https://2017zhangyuxuan.github.io/2021/11/01/2021-11/2021-11-01%20CryptoPP%E5%BA%93%E4%BD%BF%E7%94%A8/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="在比特币系统中使用了大量哈希加密、签名验证等操作，为了用代码来模拟实现比特币的运行过程，学习一个支持密码原语操作的第三方库是非常有必要的。本文将介绍CryptoPP第三方库的相关使用方法，并展示具体的代码实现。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-11-01T01:55:11.000Z"><meta property="article:modified_time" content="2021-11-01T02:35:01.825Z"><meta property="article:author" content="Zhang Yuxuan"><meta property="article:tag" content="第三方库"><meta property="article:tag" content="CryptoPP"><meta name="twitter:card" content="summary_large_image"><title>CryptoPP C++库学习使用 - Hexo</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"2017zhangyuxuan.github.io",root:"/",version:"1.8.12",typing:{enable:!0,typeSpeed:40,cursorChar:"",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:"41ea7ec25546b456fd8c769b77c5f7b8",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"y5CeAktdcKSzcAmVadWC9kvO-gzGzoHsz",app_key:"6DumtsnWAqBVLRmOTnmYxXx6",server_url:"https://y5ceaktd.lc-cn-n1-shared.com"}},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>KingOfDark</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://cdn.jsdelivr.net/gh/2017zhangyuxuan/picture_backend@master//hexo_img/yourname6.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="CryptoPP C++库学习使用"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-11-01 09:55" pubdate>2021年11月1日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 10k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 32 分钟</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">CryptoPP C++库学习使用</h1><p class="note note-info">本文最后更新于：2021年11月1日 上午</p><div class="markdown-body"><h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1><blockquote><p>参考书籍：《深入浅出CryptoPP密码学库》<br>crypto++ 密码学库 ：<a target="_blank" rel="noopener" href="https://github.com/weidai11/cryptopp">https://github.com/weidai11/cryptopp</a><br>电子书下载 ：<a target="_blank" rel="noopener" href="https://gitee.com/locomotive_crypto">https://gitee.com/locomotive_crypto</a></p></blockquote><p>最近在学习比特币相关技术，在比特币系统中使用大量哈希加密、签名验证等操作，为了用代码来模拟实现比特币的运行过程，学习一个支持密码原语操作的第三方库是非常有必要的。</p><p>最为知名的密码学相关开源库应该是OpenSSL了，但是由于官网是一堆英文，学习起来太吃力，后来机缘巧合下发现了CryptoPP这个库，而且还有专门的中文书籍来讲解使用，因此就决定学习CryptoPP库，本篇论文也是基于《深入浅出CryptoPP密码学库》阅读，整理出关键章节内容，供大家参考学习。</p><p class="note note-info">1. CryptoPP库的安装使用这里不再详细说明，请大家自行搜索网上教程<br>2. 后来看到OpenSSL也有一个中文手册学习网站，也推荐给大家https://www.openssl.net.cn/</p><h1 id="string-和-secbyteblock类型互换"><a class="markdownIt-Anchor" href="#string-和-secbyteblock类型互换"></a> string 和 SecByteBlock类型互换</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// SecByteBlock 转 string</span><br><br>SecByteBlock iv; ... <span class="hljs-comment">// C++-style cast </span><br><br>std::string token = std::<span class="hljs-built_in">string</span>(<span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>*&gt;(iv.<span class="hljs-built_in">data</span>()), iv.<span class="hljs-built_in">size</span>());<br><br><br><br><span class="hljs-comment">// string 转 SecByteBlock</span><br><br>std::string str; ... <span class="hljs-comment">// C++-style cast </span><br><br><span class="hljs-function">SecByteBlock <span class="hljs-title">sbb</span><span class="hljs-params">(<span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-keyword">const</span> byte*&gt;(str.data()), str.size())</span></span>;<br></code></pre></td></tr></table></figure><h1 id="第四章-初识cryptopp库"><a class="markdownIt-Anchor" href="#第四章-初识cryptopp库"></a> 第四章 初识CryptoPP库</h1><h2 id="hex编解码字符串"><a class="markdownIt-Anchor" href="#hex编解码字符串"></a> Hex编解码字符串</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;filters.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;hex.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> CryptoPP;<br><br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-comment">// 第一种编码方式</span><br><br>    HexEncoder hex;<br><br>    string str = <span class="hljs-string">&quot;I like&quot;</span>;<br><br>    string hexstr;<br><br>    hex.<span class="hljs-built_in">Detach</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringSink</span>(hexstr));<br><br>    hex.<span class="hljs-built_in">Put</span>(<span class="hljs-keyword">reinterpret_cast</span>&lt;byte*&gt;(&amp;str[<span class="hljs-number">0</span>]),str.<span class="hljs-built_in">size</span>());  <span class="hljs-comment">// 注意是会追加写入的</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;str:&quot;</span> &lt;&lt; str &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;hexstr:&quot;</span> &lt;&lt; hexstr &lt;&lt; endl;<br><br><br><br>    <span class="hljs-comment">// 第二种编解码写法  Source -&gt; Filter -&gt; Sink  这是一种Pipeline的方式</span><br><br>    string encode,decode;<br><br>    <span class="hljs-function">StringSource <span class="hljs-title">enc</span><span class="hljs-params">(str, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> HexEncoder(<span class="hljs-keyword">new</span> StringSink(encode)))</span></span>;<br><br>    <span class="hljs-function">StringSource <span class="hljs-title">dec</span><span class="hljs-params">(hexstr, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> HexDecoder(<span class="hljs-keyword">new</span> StringSink(decode)))</span></span>;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;encode:&quot;</span>&lt;&lt;encode &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;decode:&quot;</span>&lt;&lt;decode &lt;&lt; endl;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="第五章-随机数生成器"><a class="markdownIt-Anchor" href="#第五章-随机数生成器"></a> 第五章 随机数生成器</h1><p>主要可以关注GenerateBlock方法，生成指定字节长度的随机数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;osrng.h&gt;</span> <span class="hljs-comment">// 可以使用 AutoSeededRandomPool ，该随机器不用设置种子</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;rng.h&gt;</span> <span class="hljs-comment">//包含LC_RNG算法的头文件</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span> <span class="hljs-comment">//使用cout、cin</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std; <span class="hljs-comment">//std是C++的命名空间</span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> CryptoPP; <span class="hljs-comment">//CryptoPP是CryptoPP库的命名空间</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> Array_Size 64</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-comment">//定义一个LC_RNG随机数发生器对象，并设置其种子</span><br><br>    <span class="hljs-function">LC_RNG  <span class="hljs-title">rng</span><span class="hljs-params">(time(<span class="hljs-number">0</span>))</span></span>;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;产生一个比特的随机数：&quot;</span> &lt;&lt; rng.<span class="hljs-built_in">GenerateBit</span>() &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;产生一个字节的随机数：&quot;</span> &lt;&lt; rng.<span class="hljs-built_in">GenerateByte</span>() &lt;&lt; endl;<br><br>    byte output[Array_Size + <span class="hljs-number">1</span>] = &#123;<span class="hljs-number">0</span>&#125;;<span class="hljs-comment">//定义一个缓冲区      </span><br><br><br><br>    <span class="hljs-comment">//产生Array_Size字节长度的随机数</span><br><br>    rng.<span class="hljs-built_in">GenerateBlock</span>(output, Array_Size);  <span class="hljs-comment">// 这里也可直接传入SecByteBlock</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;产生Array_Size长度的随机数（十六进制）：&quot;</span> &lt;&lt; endl;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; Array_Size; ++i)<br><br>    &#123;<span class="hljs-comment">//将获得的随机数转换成十六进制并输出</span><br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02X&quot;</span>, output[i]);<br><br>    &#125;<br><br>    cout &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;产生一个100到1000之间的随机数：&quot;</span> &lt;&lt; rng.<span class="hljs-built_in">GenerateWord32</span>(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>) &lt;&lt; endl;<br><br><br><br>    <span class="hljs-comment">//丢弃掉随机数发生器接下来产生的100个字节数据</span><br><br>    rng.<span class="hljs-built_in">DiscardBytes</span>(<span class="hljs-number">100</span>);<br><br>    <span class="hljs-keyword">int</span> arry[] = &#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span> &#125;;<br><br>    rng.<span class="hljs-built_in">Shuffle</span>(arry, arry + <span class="hljs-number">10</span>); <span class="hljs-comment">//打乱数组arry中元素的顺序</span><br><br>    <br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="第六章-hash函数"><a class="markdownIt-Anchor" href="#第六章-hash函数"></a> 第六章 Hash函数</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;sha.h&gt;</span> <span class="hljs-comment">//使用SHA384</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;filters.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;hex.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span> <span class="hljs-comment">//使用cout、cin</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std; <span class="hljs-comment">//std是C++的命名空间</span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> CryptoPP; <span class="hljs-comment">//CryptoPP是CryptoPP库的命名空间</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-keyword">try</span><br><br>    &#123;<br><br>        SHA256 sha; <span class="hljs-comment">//定义一个SHA256的类对象</span><br><br>        byte msg[] = <span class="hljs-string">&quot;I like cryptography very much&quot;</span>;<br><br><br><br>        <span class="hljs-comment">// 使用pipeline范式</span><br><br>        <span class="hljs-function">SecByteBlock <span class="hljs-title">tmp</span><span class="hljs-params">(msg, <span class="hljs-keyword">sizeof</span>(msg)<span class="hljs-number">-1</span>)</span></span>;<br><br>        string r;<br><br>        <span class="hljs-function">StringSource <span class="hljs-title">s1</span> <span class="hljs-params">(tmp, tmp.size(),<span class="hljs-literal">true</span>,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> HashFilter(sha,    <span class="hljs-comment">// 使用其他hash函数，更换一下类型即可</span></span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> HexEncoder(</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> StringSink(r))))</span></span>;<br><br>        cout &lt;&lt; r &lt;&lt; endl;<br><br>        r.<span class="hljs-built_in">clear</span>();  <span class="hljs-comment">// 清空一下，不然后面会追加</span><br><br><br><br>        <span class="hljs-comment">// 连续两次Hash256，再用Hex编码输出</span><br><br>        SHA256 sha2;<br><br>        <span class="hljs-function">StringSource <span class="hljs-title">s2</span> <span class="hljs-params">(<span class="hljs-string">&quot;I like cryptography very much&quot;</span>,<span class="hljs-literal">true</span>,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> HashFilter(sha,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> HashFilter(sha2,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> HexEncoder(</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                         <span class="hljs-keyword">new</span> StringSink(r)))) )</span></span>;<br><br>        cout &lt;&lt; r &lt;&lt; endl;<br><br><br><br>        <span class="hljs-function">SecByteBlock <span class="hljs-title">digest</span><span class="hljs-params">(sha.DigestSize())</span></span>; <span class="hljs-comment">//申请内存空间以存放消息摘要</span><br><br>        <span class="hljs-comment">//CalculateDigest()相当于Update()+Final()</span><br><br>        <span class="hljs-comment">// Update用来向sha输入，Final计算hash值，同时重置hash函数内部状态</span><br><br>        sha.<span class="hljs-built_in">CalculateDigest</span>(digest, msg, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(msg) - <span class="hljs-number">1</span>);<br><br>        cout &lt;&lt; <span class="hljs-string">&quot;digest2=&quot;</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; sha.<span class="hljs-built_in">DigestSize</span>(); ++i)<br><br>        &#123;<span class="hljs-comment">//以十六进制输出Hash值</span><br><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02X&quot;</span>, digest[i]);<br><br>        &#125;<br><br>        cout &lt;&lt; endl;<br><br><br><br>        <span class="hljs-comment">//计算msg消息的Hash值</span><br><br>        <span class="hljs-keyword">bool</span> res;<br><br>        res = sha.<span class="hljs-built_in">VerifyDigest</span>(digest, <span class="hljs-comment">//可能抛出异常</span><br><br>                               msg, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(msg) - <span class="hljs-number">1</span>); <span class="hljs-comment">//去掉字符串最后的&#x27;\0&#x27;</span><br><br>        cout &lt;&lt; <span class="hljs-string">&quot;res = &quot;</span> &lt;&lt; boolalpha &lt;&lt;res &lt;&lt; endl;  <span class="hljs-comment">// 这里的boolalpha 是为了输出bool值true或者false</span><br><br><br><br>    &#125;<br><br>    <span class="hljs-built_in"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword">const</span> Exception&amp; e)<br><br>    &#123;<span class="hljs-comment">//出现异常</span><br><br>        cout &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; endl; <span class="hljs-comment">//异常原因</span><br><br>    &#125;<br><br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="第十一章-公钥密码学数学基础"><a class="markdownIt-Anchor" href="#第十一章-公钥密码学数学基础"></a> 第十一章 公钥密码学数学基础</h1><h2 id="大整数-与-大素数生成"><a class="markdownIt-Anchor" href="#大整数-与-大素数生成"></a> 大整数 与 大素数生成</h2><ul><li>可以再研究一下大整数的一些用法</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;integer.h&gt;</span><span class="hljs-comment">//使用Integer</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span><span class="hljs-comment">//使用cout、cin</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;osrng.h&gt;</span><span class="hljs-comment">//使用AutoSeededRandomPool</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;nbtheory.h&gt;</span><span class="hljs-comment">//使用PrimeAndGenerator、VerifyPrime</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<span class="hljs-comment">//std是C++的命名空间</span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> CryptoPP;<span class="hljs-comment">//CryptoPP是CryptoPP库的命名空间</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br><br>    AutoSeededRandomPool rng; <span class="hljs-comment">// 定义随机数发生器对象</span><br><br>    <span class="hljs-comment">// 定义PrimeAndGenerator对象，利用随机数发生器rng产生素数p和q</span><br><br>    <span class="hljs-comment">// 要求产生的p是1024比特的素数，q是512比特的素数</span><br><br>    <span class="hljs-function">PrimeAndGenerator <span class="hljs-title">pag</span><span class="hljs-params">(<span class="hljs-number">1</span>, rng, <span class="hljs-number">1024</span>, <span class="hljs-number">512</span>)</span></span>;<br><br>    Integer p = pag.<span class="hljs-built_in">Prime</span>(); <span class="hljs-comment">// 获取素数p的值</span><br><br>    Integer q = pag.<span class="hljs-built_in">SubPrime</span>(); <span class="hljs-comment">// 获取素数q的值</span><br><br>    Integer r = (p - <span class="hljs-number">1</span>) / q / <span class="hljs-number">2</span>; <span class="hljs-comment">// 计算r的值，因为p=2*r*q+1，delta=1</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;p(&quot;</span> &lt;&lt; p.<span class="hljs-built_in">BitCount</span>() &lt;&lt; <span class="hljs-string">&quot;)：&quot;</span> &lt;&lt; p &lt;&lt; endl; <span class="hljs-comment">// 打印p的值及比特数</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;q(&quot;</span> &lt;&lt; q.<span class="hljs-built_in">BitCount</span>() &lt;&lt; <span class="hljs-string">&quot;)：&quot;</span> &lt;&lt; q &lt;&lt; endl; <span class="hljs-comment">// 打印q的值及比特数</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;r(&quot;</span> &lt;&lt; r.<span class="hljs-built_in">BitCount</span>() &lt;&lt; <span class="hljs-string">&quot;)：&quot;</span> &lt;&lt; r &lt;&lt; endl; <span class="hljs-comment">// 打印r的值及比特数</span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">VerifyPrime</span>(rng, r, <span class="hljs-number">10</span>)) <span class="hljs-comment">// 验证r是否为素数</span><br><br>    &#123;<br><br>        cout &lt;&lt; <span class="hljs-string">&quot;r是素数&quot;</span> &lt;&lt; endl; <span class="hljs-comment">// 如果r为素数，则输出该信息</span><br><br>    &#125;<br><br>    <span class="hljs-keyword">else</span><br><br>    &#123;<br><br>        cout &lt;&lt; <span class="hljs-string">&quot;r不是素数&quot;</span> &lt;&lt; endl; <span class="hljs-comment">// 如果r不为素数，则输出该信息</span><br><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="第十三章-数字签名"><a class="markdownIt-Anchor" href="#第十三章-数字签名"></a> 第十三章 数字签名</h1><p>电子书给出的参考是ECNR数字签名算法</p><p><a target="_blank" rel="noopener" href="https://www.cryptopp.com/wiki/Elliptic_Curve_Digital_Signature_Algorithm">ECDSA椭圆曲线 - Crypto++</a></p><p><a target="_blank" rel="noopener" href="https://www.cryptopp.com/wiki/Elliptic_Curve_Digital_Signature_Algorithm">https://www.cryptopp.com/wiki/Elliptic_Curve_Digital_Signature_Algorithm</a> -》关于压缩公钥的实现可以参考 Compressed Point 这一部分</p><h2 id="私钥和公钥生成-保存"><a class="markdownIt-Anchor" href="#私钥和公钥生成-保存"></a> 私钥和公钥生成、保存</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;integer.h&gt;</span><span class="hljs-comment">//使用Integer</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span><span class="hljs-comment">//使用cout、cin</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;osrng.h&gt;</span><span class="hljs-comment">//使用AutoSeededRandomPool</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;eccrypto.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;oids.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;files.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;filters.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;filesystem&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;hex.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;base32.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<span class="hljs-comment">//std是C++的命名空间</span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> CryptoPP;<span class="hljs-comment">//CryptoPP是CryptoPP库的命名空间</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ECDSA_Generate</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    // 指定 private exponent  32字节随机数，生成对应的私钥</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    string exp = &quot;E4A6CFB431471CFCAE491FD566D19C87082CF9FA7722D7FA24B2B3F5669DBEFB&quot;;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    HexDecoder decoder;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    decoder.Put((byte*)&amp;exp[0], exp.size());</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    decoder.MessageEnd();</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    Integer x;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    x.Decode(decoder, decoder.MaxRetrievable());</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    privateKey.Initialize(ASN1::secp256r1(), x);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">     */</span><br><br><br><br>    AutoSeededRandomPool prng;<br><br>    ECDSA&lt;ECP, SHA256&gt;::PrivateKey privateKey;<br><br><br><br>    privateKey.<span class="hljs-built_in">Initialize</span>( prng, ASN1::<span class="hljs-built_in">secp256k1</span>() );<br><br><br><br>    <span class="hljs-comment">/* 使用ByteQueue 方便将公私钥存储在内存中，如果要持久化到磁盘，可以使用FileSink</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    ByteQueue queue;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    privateKey.Save(queue);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    privateKey.Load(queue);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    */</span><br><br><br><br>    <span class="hljs-comment">// 验证密钥强度</span><br><br>    <span class="hljs-keyword">bool</span> result = privateKey.<span class="hljs-built_in">Validate</span>( prng, <span class="hljs-number">3</span> );<br><br>    cout &lt;&lt; boolalpha &lt;&lt; result &lt;&lt; endl;<br><br><br><br>    Integer p = privateKey.<span class="hljs-built_in">GetPrivateExponent</span>();<br><br>    cout&lt;&lt; <span class="hljs-string">&quot;len:&quot;</span> &lt;&lt; p.<span class="hljs-built_in">BitCount</span>() &lt;&lt; <span class="hljs-string">&quot; Private Key:&quot;</span> &lt;&lt; p &lt;&lt; endl;<br><br>    string priHexKey;<br><br>    <span class="hljs-function">HexEncoder <span class="hljs-title">encoder</span><span class="hljs-params">(<span class="hljs-keyword">new</span> StringSink(priHexKey))</span></span>;<br><br>    p.<span class="hljs-built_in">Encode</span>(encoder, <span class="hljs-number">32</span>);<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;priHexKey:&quot;</span>&lt;&lt;priHexKey.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">&quot;  &quot;</span> &lt;&lt; priHexKey &lt;&lt; endl;<br><br><br><br>    <span class="hljs-comment">// Save private key in PKCS #8 format</span><br><br>    <span class="hljs-function">FileSink <span class="hljs-title">fs1</span><span class="hljs-params">( <span class="hljs-string">&quot;../../../keys/private.ec.der&quot;</span>, <span class="hljs-literal">true</span> <span class="hljs-comment">/*binary*/</span> )</span></span>;<br><br>    privateKey.<span class="hljs-built_in">Save</span>( fs1 );<br><br><br><br>    <span class="hljs-comment">// Generate publicKey</span><br><br>    ECDSA&lt;ECP, CryptoPP::SHA256&gt;::PublicKey publicKey;<br><br>    privateKey.<span class="hljs-built_in">MakePublicKey</span>(publicKey);<br><br>    <span class="hljs-keyword">const</span> ECP::Point&amp; q = publicKey.<span class="hljs-built_in">GetPublicElement</span>();<br><br>    <span class="hljs-keyword">const</span> Integer&amp; qx = q.x;<br><br>    <span class="hljs-keyword">const</span> Integer&amp; qy = q.y;<br><br>    string qxHex, qyHex;<br><br>    <span class="hljs-function">HexEncoder <span class="hljs-title">encoderx</span><span class="hljs-params">(<span class="hljs-keyword">new</span> StringSink(qxHex))</span></span>;<br><br>    <span class="hljs-function">HexEncoder <span class="hljs-title">encodery</span><span class="hljs-params">(<span class="hljs-keyword">new</span> StringSink(qyHex))</span></span>;<br><br>    qx.<span class="hljs-built_in">Encode</span>(encoderx, <span class="hljs-number">32</span>);<br><br>    qy.<span class="hljs-built_in">Encode</span>(encodery, <span class="hljs-number">32</span>);<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;len:&quot;</span> &lt;&lt; qx.<span class="hljs-built_in">BitCount</span>() &lt;&lt; <span class="hljs-string">&quot; Public Point x:&quot;</span> &lt;&lt; qx &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;qxHex:&quot;</span> &lt;&lt; qxHex &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;len:&quot;</span> &lt;&lt; qy.<span class="hljs-built_in">BitCount</span>() &lt;&lt; <span class="hljs-string">&quot; Public Point y:&quot;</span> &lt;&lt; qy &lt;&lt; endl;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;qyHex:&quot;</span> &lt;&lt; qyHex &lt;&lt; endl;<br><br><br><br>    <span class="hljs-comment">// Save public key in X.509 format</span><br><br>    <span class="hljs-function">FileSink <span class="hljs-title">fs2</span><span class="hljs-params">( <span class="hljs-string">&quot;../../../keys/public.ec.der&quot;</span>, <span class="hljs-literal">true</span> <span class="hljs-comment">/*binary*/</span> )</span></span>;<br><br>    publicKey.<span class="hljs-built_in">Save</span>( fs2 );<br><br><br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="私钥和公钥的加载-签名和认证"><a class="markdownIt-Anchor" href="#私钥和公钥的加载-签名和认证"></a> 私钥和公钥的加载、签名和认证</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// 头文件和上述一样</span><br><br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ECDSA_LOAD</span><span class="hljs-params">()</span></span>&#123;<br><br>    AutoSeededRandomPool prng;<br><br>    <span class="hljs-function">FileSource <span class="hljs-title">fs1</span><span class="hljs-params">( <span class="hljs-string">&quot;../../../keys/private.ec.der&quot;</span>, <span class="hljs-literal">true</span> <span class="hljs-comment">/*pump all*/</span> )</span></span>;<br><br>    <span class="hljs-function">FileSource <span class="hljs-title">fs2</span><span class="hljs-params">( <span class="hljs-string">&quot;../../../keys/public.ec.der&quot;</span>, <span class="hljs-literal">true</span> <span class="hljs-comment">/*pump all*/</span> )</span></span>;<br><br>    ECDSA&lt;ECP, SHA256&gt;::PrivateKey privateKey;<br><br>    ECDSA&lt;ECP, SHA256&gt;::PublicKey publicKey;<br><br>    <span class="hljs-comment">// 加载私钥， 私钥格式：PKCS #8</span><br><br>    privateKey.<span class="hljs-built_in">Load</span>( fs1 );<br><br>    publicKey.<span class="hljs-built_in">Load</span>(fs2);<br><br><br><br>    <span class="hljs-comment">// 用私钥进行签名</span><br><br>    ECDSA&lt;ECP, SHA256&gt;::<span class="hljs-function">Signer <span class="hljs-title">signer</span><span class="hljs-params">(privateKey)</span></span>;<br><br>    string message = <span class="hljs-string">&quot;Yoda said, Do or do not. There is no try.&quot;</span>;<br><br>    string signature;<br><br><br><br><br><br>    <span class="hljs-function">StringSource <span class="hljs-title">s</span><span class="hljs-params">( message, <span class="hljs-literal">true</span> <span class="hljs-comment">/*pump all*/</span>,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                    <span class="hljs-keyword">new</span> SignerFilter( prng,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                                      signer,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                                      <span class="hljs-keyword">new</span> StringSink( signature )</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                    ) <span class="hljs-comment">// SignerFilter</span></span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>; <span class="hljs-comment">// StringSource</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;signature len:&quot;</span> &lt;&lt; signature.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">&quot; output:&quot;</span> &lt;&lt; signature &lt;&lt; endl;<br><br><br><br>    <span class="hljs-comment">// 将签名（包含R，S）转换成 DER 格式</span><br><br>    std::string derSign;<br><br>    <span class="hljs-comment">// Make room for the ASN.1/DER encoding</span><br><br>    derSign.<span class="hljs-built_in">resize</span>(<span class="hljs-number">3</span>+<span class="hljs-number">3</span>+<span class="hljs-number">3</span>+<span class="hljs-number">2</span>+signature.<span class="hljs-built_in">size</span>());<br><br>    <span class="hljs-keyword">size_t</span> converted_size = <span class="hljs-built_in">DSAConvertSignatureFormat</span>(<br><br>            (byte*) (&amp;derSign[<span class="hljs-number">0</span>]), derSign.<span class="hljs-built_in">size</span>(), DSA_DER,<br><br>            (<span class="hljs-keyword">const</span> byte*) (signature.<span class="hljs-built_in">data</span>()), signature.<span class="hljs-built_in">size</span>(), DSA_P1363);<br><br>    derSign.<span class="hljs-built_in">resize</span>(converted_size);<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;DER len:&quot;</span> &lt;&lt; derSign.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">&quot; DER:&quot;</span> &lt;&lt; derSign &lt;&lt; endl;<br><br>    string hexDER;<br><br>    <span class="hljs-function">StringSource <span class="hljs-title">toDER</span><span class="hljs-params">(derSign, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> HexEncoder(<span class="hljs-keyword">new</span> StringSink(hexDER)))</span></span>;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;DER hex:&quot;</span> &lt;&lt; hexDER &lt;&lt; endl;<br><br><br><br>    <br><br>    <span class="hljs-comment">// 进行验证</span><br><br>    <span class="hljs-keyword">bool</span> result;<br><br>    ECDSA&lt;ECP, SHA256&gt;::<span class="hljs-function">Verifier <span class="hljs-title">verifier</span><span class="hljs-params">(publicKey)</span></span>;<br><br>    <span class="hljs-function">StringSource <span class="hljs-title">ss</span><span class="hljs-params">( signature+message, <span class="hljs-literal">true</span> <span class="hljs-comment">/*pump all*/</span>,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                     <span class="hljs-keyword">new</span> SignatureVerificationFilter(</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                             verifier,</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                             <span class="hljs-keyword">new</span> ArraySink( (byte*)&amp;result, <span class="hljs-keyword">sizeof</span>(result) )</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">                     ) <span class="hljs-comment">// SignatureVerificationFilter</span></span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br><br><br><br>    <span class="hljs-comment">// 传统的C 方式 - 函数调用形式</span><br><br><span class="hljs-comment">//    result = verifier.VerifyMessage( (const byte*)message.data(), message.size(), (const byte*)signature.data(), signature.size() );</span><br><br>    <span class="hljs-keyword">if</span>(result)<br><br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Verified signature on message&quot;</span> &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">else</span><br><br>        std::cerr &lt;&lt; <span class="hljs-string">&quot;Failed to verify signature on message&quot;</span> &lt;&lt; std::endl;<br><br><br><br>&#125;<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/">计算机知识</a> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/">第三方库</a> <a class="hover-with-bg" href="/tags/CryptoPP/">CryptoPP</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/2021/11/13/2021-11/2021-11-13%20%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%93%E9%A2%9803-%E9%9A%94%E7%A6%BB%E8%A7%81%E8%AF%81%E3%80%81%E9%97%AA%E7%94%B5%E7%BD%91%E7%BB%9C/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">【比特币专题03】隔离见证、闪电网络</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2021/10/20/2021-10/2021-10-20%20Ubuntu-arm%20apt%E6%BA%90%E9%85%8D%E7%BD%AE/"><span class="hidden-mobile">Ubuntu-arm apt源配置</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="waline"></div><script>Fluid.utils.loadComments("#waline",function(){Fluid.utils.createScript("https://cdn.jsdelivr.net/npm/@waline/client@1/dist/Waline.min.js",function(){var a=Object.assign({serverURL:"https://blog-api-cwpbgt9h8-2017zhangyuxuan.vercel.app",path:"window.location.pathname",placeholder:"期待地搓搓手~",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',avatar:"mp",avatarCDN:"https://seccdn.libravatar.org/avatar/",avatarForce:!1,wordLimit:0,pageSize:10,highlight:!0},{el:"#waline",path:window.location.pathname});new Waline(a),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{Fluid.plugins.initFancyBox("#waline .vcontent img:not(.vemoji)")})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><br></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">浙ICP备2022004380号-1 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011502005551" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备11011502005551号</span></a></span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/local-search.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?41ea7ec25546b456fd8c769b77c5f7b8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/js/boot.js"></script></body></html>