<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="密码学是比特币系统实现的重要组成部分，本期专题将介绍椭圆曲线密码算法在比特币中的应用，重点介绍公私钥和比特币地址的生成，钱包相关技术，以及交易中数字签名和验证。"><meta name="author" content="Zhang Yuxuan"><meta name="keywords" content=""><meta name="description" content="密码学是比特币系统实现的重要组成部分，本期专题将介绍椭圆曲线密码算法在比特币中的应用，重点介绍公私钥和比特币地址的生成，钱包相关技术，以及交易中数字签名和验证。"><meta property="og:type" content="article"><meta property="og:title" content="【比特币专题04】椭圆曲线密码算法在比特币中的应用"><meta property="og:url" content="https://2017zhangyuxuan.github.io/2021/11/27/2021-11/2021-11-27%20%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%93%E9%A2%9804-%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%AF%86%E7%A0%81%E7%AE%97%E6%B3%95%E5%9C%A8%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="密码学是比特币系统实现的重要组成部分，本期专题将介绍椭圆曲线密码算法在比特币中的应用，重点介绍公私钥和比特币地址的生成，钱包相关技术，以及交易中数字签名和验证。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271547812.(null)"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513682.(null)"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513117.(null)"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271547830.(null)"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513500.(null)"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513760.(null)"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513936.(null)"><meta property="og:image" content="https://kwaj2xdt3y.feishu.cn/space/api/box/stream/download/asynccode/?code=MDYwZjYzODI5NTFjOThiYTQ3MzZiM2JhMjAyNWIxNTBfazRleGFLaGlDbFVMOHlsZzllb01uelhQVkJ3SUo5RnJfVG9rZW46Ym94Y256d2Z4M2ZhWWR1NDZmeEtiV2hJOHRlXzE2Mzc5OTcyMDk6MTYzODAwMDgwOV9WNA"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513603.(null)"><meta property="article:published_time" content="2021-11-27T07:40:54.000Z"><meta property="article:modified_time" content="2022-06-05T05:22:42.376Z"><meta property="article:author" content="Zhang Yuxuan"><meta property="article:tag" content="Bitcoin"><meta property="article:tag" content="ECDSA"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271547812.(null)"><title>【比特币专题04】椭圆曲线密码算法在比特币中的应用 - Hexo</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/10.7.3/styles/github-gist.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"2017zhangyuxuan.github.io",root:"/",version:"1.8.12",typing:{enable:!0,typeSpeed:40,cursorChar:"",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:"41ea7ec25546b456fd8c769b77c5f7b8",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"y5CeAktdcKSzcAmVadWC9kvO-gzGzoHsz",app_key:"6DumtsnWAqBVLRmOTnmYxXx6",server_url:"https://y5ceaktd.lc-cn-n1-shared.com",path:"window.location.pathname"}},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>KingOfDark</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/hexo_img/yourname6.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="【比特币专题04】椭圆曲线密码算法在比特币中的应用"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-11-27 15:40" pubdate>2021年11月27日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 9.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 29 分钟</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">【比特币专题04】椭圆曲线密码算法在比特币中的应用</h1><p class="note note-info">本文最后更新于：2022年6月5日 下午</p><div class="markdown-body"><h1 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h1><ul><li>不同于以太坊的账户模型，比特币采用的是UTXO模型，比特币的所有权是通过<em>数字密钥、比特币地址和数字签名</em>来确定的。数字密钥实际上并不存储在网络中，而是由用户生成之后，存储在一个叫做<em>钱包</em>的文件或简单的数据库中。用户钱包中的数字密钥完全独立于比特币协议，可由用户的钱包软件生成并管理，而无需参照区块链或访问互联网。</li><li>密钥是成对出现的，由私钥和公钥所组成。公钥就像银行的帐号，而私钥就像银行卡的密码或支票的签名。比特币的用户很少会直接看到数字密钥。一般情况下，它们存储在钱包文件内，由比特币钱包软件进行管理。</li><li>在比特币交易的支付环节，收款人的公钥由数字指纹表示，称为<em>比特币地址</em>，就像支票上收款人名称 （即“付给谁的账户”）。一般情况下，比特币地址由公钥生成并与之对应。然而，并非所有比特币地址都代表公钥； 也可以代表其他支付对象，譬如脚本。这样一来，比特币地址就可以抽象成资金接收者，使得交易更灵活，就像纸质支票：可以支付到个人账户或公司账户，也可以支付账单和现金。比特币地址是密钥被用户能够看到的唯一形式，因为这个地址就是需要告诉别人的。</li><li>以上是对比特币和密码学应用的简单概述，而本篇文章将重点关注椭圆曲线密码算法在比特币中的应用，将从与之密切相关的密钥与地址、钱包、交易三部分介绍相关内容。</li></ul><h1 id="密钥与地址"><a class="markdownIt-Anchor" href="#密钥与地址"></a> 密钥与地址</h1><ul><li>在比特币系统中，我们用公钥密码学技术创建一个密钥对，用于控制对比特币的访问。密钥对包括一个私钥，和由其衍生出的唯一的公钥。公钥用于接收比特币，而私钥用于支付时进行交易签名。</li><li>比特币正是使用椭圆曲线密码算法作为其公钥密码学的基础。</li></ul><h2 id="私钥与公钥与地址"><a class="markdownIt-Anchor" href="#私钥与公钥与地址"></a> 私钥与公钥与地址</h2><p>一个比特币钱包中包含一系列的密钥对，每个密钥对包括一个私钥和一个公钥。私钥（<em>k</em>）是一个数字，通常是随机选出的。基于私钥，我们就可以使用椭圆曲线乘法这个单向密码函数产生一个公钥（<em>K</em>）。基于公钥（<em>K</em>），我们就可以使用一个单向密码哈希函数生成比特币地址（<em>A</em>）。私钥、公钥和比特币地址之间的关系如下图所示。</p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271547812.(null)" srcset="/img/loading.gif" lazyload alt="私钥、公钥和比特币地址之间的关系"></p><h2 id="私钥"><a class="markdownIt-Anchor" href="#私钥"></a> 私钥</h2><ul><li><p>私钥就是一个随机选出的数字而已。拥有和控制了私钥，就相当于控制了该私钥对应的比特币地址中的所有资金。通过证明比特币交易中资金的所有权，私钥可以生成花费该笔资金的签名。</p></li><li><p><em><strong>从一个随机数生成私钥</strong></em> 是生成密钥的第一步也是最重要的一步，是要找到足够安全的熵源，即随机性来源。生成一个比特币私钥在本质上与“在1到2<sup>256</sup>之间选一个数字”无异。只要选取的结果是不可预测或不可重复的，那么选取数字的具体方法并不重要。比特币软件使用操作系统底层的随机数生成器来产生256位的熵（随机性）。</p></li><li><p>更准确地说，私钥可以是1和n-1之间的任何数字，其中n是一个常数（n=1.158 * 10<sup>77</sup>，略小于2<sup>256</sup>），并被定义为由比特币所使用的椭圆曲线的阶（比特币使用的是 <strong>secp256k1</strong> 标准所定义的一种特殊的椭圆曲线和一系列数学常数。该标准由美国国家标准与技术研究院 （NIST）建立）。要生成这样的一个私钥，我们随机选择一个256位的数字，并检查它是否小于n-1。从编程的角度来看，一般是通过在一个密码学安全的随机源中取出一长串随机字节，对其使用SHA256哈希算法进行运算，这样就可以方便地产生一个256位的数字。如果运算结果小于n，我们就有了一个合适的私钥。否则，我们就用另一个随机数再重复一次。</p></li><li><h2 id="公钥"><a class="markdownIt-Anchor" href="#公钥"></a> 公钥</h2></li></ul><p>以一个随机生成的私钥<em>k</em>为起点，将其乘以曲线上一个预定的点，叫做<em>生成点G</em>得到曲线上的另一点，这就是相应的公钥 <em>K</em>。生成点是secp256k1标准的一部分，比特币密钥的生成点都是相同的：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi><mo>=</mo><mi>k</mi><mo>∗</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">K = k * G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathdefault" style="margin-right:.07153em">K</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathdefault" style="margin-right:.03148em">k</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathdefault">G</span></span></span></span></span></p><p>其中<em>k</em>是私钥，<em>G</em>是生成点，在该曲线上所得的点<em>K</em>是公钥。因为所有比特币用户的生成点是相同的，一个私钥<em>k</em>乘以<em>G</em>将得到相同的公钥<em>K</em>。<em>k</em>和<em>K</em>之间的关系是固定的，但只能单向运算，即从<em>k</em>得到<em>K</em>。这就是可以把比特币地址（<em>K</em>的衍生） 与任何人共享而不会泄露私钥（<em>k</em>）的原因。</p><p>实现了椭圆曲线乘法，我们就可以用随机产生的私钥<em>k</em>和与生成点<em>G</em>相乘得到公钥<em>K</em>。下面给出一个简单例子。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Bash">k = 1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD <br>K = k * G<br><br>公钥K被定义为一个点 K = (x, y) ，其中：<br>x = F028892BAD7ED57D2FB57BF33081D5CFCF6F9ED3D3D7F159C2E2FFF579DC341A <br>y = 07CF33DA18BD734C600B96A72BBC4749D5141C90EC8AC328AE52DDFE2E505BDB<br></code></pre></td></tr></table></figure><h2 id="比特币地址"><a class="markdownIt-Anchor" href="#比特币地址"></a> 比特币地址</h2><p>比特币地址可由公钥经过单向哈希算法得到。密码学哈希算法是一种单向函数，接收任意长度的输入产生指纹或哈希。哈希函数在比特币中被广泛使用 ：比特币地址、脚本地址以及在挖矿中的工作量证明算法。由公钥生成比特币地址时使用的算法是Secure Hash Algorithm (SHA)和the RACE Integ rity Primitives Evaluation Message Digest (RIPEMD)，具体来说是SHA256和RIPEMD160。</p><p>以公钥 <em>K</em> 为输入，计算其SHA256哈希值，并以此结果计算RIPEMD160 哈希值，得到一个长度为160位（20字节）的数字：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo>=</mo><mi>R</mi><mi>I</mi><mi>P</mi><mi>E</mi><mi>M</mi><mi>D</mi><mn>160</mn><mo stretchy="false">(</mo><mi>S</mi><mi>H</mi><mi>A</mi><mn>256</mn><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A = RIPEMD160(SHA256(K))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathdefault" style="margin-right:.00773em">R</span><span class="mord mathdefault" style="margin-right:.07847em">I</span><span class="mord mathdefault" style="margin-right:.13889em">P</span><span class="mord mathdefault" style="margin-right:.05764em">E</span><span class="mord mathdefault" style="margin-right:.10903em">M</span><span class="mord mathdefault" style="margin-right:.02778em">D</span><span class="mord">1</span><span class="mord">6</span><span class="mord">0</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:.05764em">S</span><span class="mord mathdefault" style="margin-right:.08125em">H</span><span class="mord mathdefault">A</span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:.07153em">K</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>公式中，<em>K</em>是公钥，<em>A</em>是生成的比特币地址。</p><p>通常用户见到的比特币地址是经过“<strong>Base58Check</strong>”编码的（参见下面的“Base58Check Encoding”一图），这种编码使用了58个字符（Base58数字系统）和校验码，提高了可读性、避免歧义并有效防止了在地址转录和输入中产生的错误。Base58Check编码也被用于比特币的其它地方，例如比特币地址、私钥、加密的密钥和脚本哈希中，用来提高可读性和录入的正确性。</p><center class="half"><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513682.(null)" srcset="/img/loading.gif" lazyload width="300"><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513117.(null)" srcset="/img/loading.gif" lazyload width="400"></center><hr><ul><li><strong>WIF(Wallet import format)</strong> 钱包导入格式，(也被称为电子钱包的导出格式)是一种私有的 ESCDSA (椭圆曲线签名算法) 秘钥，意在使私钥更容易复制，私钥的各种形式如下表所示。</li></ul><table><thead><tr><th>Type</th><th>Prefix</th><th>Description</th></tr></thead><tbody><tr><td>Raw</td><td>None</td><td>32字节</td></tr><tr><td>Hex</td><td>None</td><td>64位Hex编码</td></tr><tr><td>WIF</td><td>5</td><td>使用Base58Check进行编码</td></tr><tr><td>WIF-compressed</td><td>K or L</td><td>使用Base58Check进行编码，但在编码前增加后缀0x01</td></tr></tbody></table><table><thead><tr><th style="text-align:left">Format</th><th>Private key</th></tr></thead><tbody><tr><td style="text-align:left">Hex</td><td>1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd</td></tr><tr><td style="text-align:left">WIF</td><td>5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn</td></tr><tr><td style="text-align:left">WIF-compressed</td><td>KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ</td></tr></tbody></table><ul><li>公钥也可以用多种不同格式来表示，通常分为非压缩格式或压缩格式公钥这两种形式。</li><li>我们从前文可知，公钥是在椭圆曲线上的一个点，由一对坐标（x，y）组成。公钥通常表示为前缀04紧接着两个256位的数字。其中一个256位数字是公钥的x坐标，另一个256位数字是y坐标。前缀04是是非压缩格式公钥， 压缩格式公钥是以02或者03开头。</li><li>正如前面所说，一个公钥是一个椭圆曲线上的点(x, y)。而椭圆曲线实际是一个数学方程，曲线上的点实际是该方程的一个解。因此，如果我们知道了公钥的x坐标，就可以通过解方程来得到y坐标。这可以让我们只存储公钥的x坐标，略去y坐标，从而将公钥的大小和存储空间减少了256位。这样每笔交易需要的字节数就会减少许多，随着时间推移，就能保存更多的交易数据。</li><li>未压缩格式公钥使用04作为前缀，而压缩格式公钥是以02或03作为前缀。为什么会有两个前缀：当<strong>我们在素数p阶的有限域上使用二进制算术计算椭圆曲线的时候，y坐标可能是偶数或者奇数</strong>。因此，为了区分y坐标的两种可能值，在生成压缩格式公钥时，如果y是偶数，则使用02作为前缀；如果y是奇数，则使用03作为前缀。这样就可以让软件能够根据x坐标，正确推导出对应的y坐标，从而将公钥解压缩为在椭圆曲线上点的完整坐标。下图阐释了公钥压缩的过程：</li></ul><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271547830.(null)" srcset="/img/loading.gif" lazyload height="50%" width="50%" align="center"></p><p class="note note-primary">注意：实际上“压缩格式私钥”是一种名称上的误导，因为当私钥使用WIF压缩格式导出时，不但没有压缩，反而比“非压缩格式”私钥长出一个字节。这个多出来的一个字节是私钥被加了后缀01，用以表明该私钥是来自于一个较新的钱包，只能被用来生成压缩公钥。私钥并没有压缩的，也不能被压缩。“压缩私钥”实际上表示“只能生成压缩公钥的私钥”，而“非压缩私钥”用来表明“只能生成非压缩公钥的私钥”。为避免更多误解，应该只可以说导出格式 是“WIF压缩格式”或者“WIF”，而不能说这个私钥是“压缩”的。</p><h1 id="钱包"><a class="markdownIt-Anchor" href="#钱包"></a> 钱包</h1><ul><li>广义上，钱包是一个应用程序，为用户提供交互界面。钱包控制用户资金访问权限，管理密钥和地址，跟踪余额以及创建和签名交易。</li><li>狭义上，“钱包”是指用于存储和管理用户密钥的数据结构。</li><li>在这一小节中，我们将更关注钱包是密钥容器的这一角度，探索椭圆曲线算法在其中的应用。</li></ul><h2 id="hd分层钱包"><a class="markdownIt-Anchor" href="#hd分层钱包"></a> HD分层钱包</h2><p>根据钱包包含的多个密钥之间是否有关系，主要分为两种类型：</p><ul><li><p>第一种类型是<em>非确定性钱包（nondeterministic wallet）</em>，其中每个密钥都是从随机数独立生成的。密钥彼此无关。</p></li><li><p>第二种类型是确定性钱包（deterministic wallet），其中所有的密钥都是从一个主密钥派生出来，这个主密钥即为种子（seed）。该类型钱包中所有密钥都相互关联，如果有原始种子，则可以再次生成全部密钥。确定性钱包中使用了许多不同的密钥推导方法。最常用的推导方法是使用树状结构，称为分层确定性（hierarchical deterministic）钱包或HD钱包。</p><ul><li>相比随机（不确定性）密钥，HD钱包有两个主要的优势。第一，树状结构可以被用来表达附加的组织含义，比如子密钥的特定分支用来接收交易收入款项，另一个分支用来负责接收对外付款的找零。密钥的分支也可以用于公司设置，将不同的分支分配给部门、子公司、特定功能或会计类别。</li><li>HD钱包的第二个好处是，用户可以创建一系列公钥，而不需要访问对应的私钥。这样，HD钱包就能用在不安全的服务器上，或者仅作为接收用途，它为每个交易发布不同的公钥。公钥不需要被预先加载或者提前衍生，服务器也不需要有用来支付的私钥。</li></ul></li></ul><hr><p>HD钱包密钥的生成过程如下图所示：通过记助词和 Salt 生成Root Seed种子，再通过HMAC-SHA512（单向哈希），输出512位bits，其中左256位作为主私钥（通过椭圆曲线密码算法可生成主公钥，采用的是压缩公钥格式264bits），右256位作为主链码。</p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513500.(null)" srcset="/img/loading.gif" lazyload width="70%" height="70%" alight="center"></p><blockquote><p>HD钱包的种子生成过程，并没有涉及椭圆曲线密码算法，因此这里不再展开介绍，具体过程可参考：<br><a target="_blank" rel="noopener" href="https://github.com/tianmingyun/MasterBitcoin2CN/blob/master/ch05.md#523-%E4%BB%8E%E5%8A%A9%E8%AE%B0%E8%AF%8D%E7%94%9F%E6%88%90%E7%A7%8D%E5%AD%90">HD分层钱包 种子生成过程</a></p></blockquote><h2 id="衍生子秘钥"><a class="markdownIt-Anchor" href="#衍生子秘钥"></a> 衍生子秘钥</h2><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513760.(null)" srcset="/img/loading.gif" lazyload width="60%" height="60%" aligh="center"></p><ul><li>子秘钥的衍生推导如上图所示：父公钥 + 父链码 + 索引作为输入， 输出512bits，右256bits作为子链码；左256bits 与 父秘钥结合得到子秘钥</li><li>衍生得到的子私钥，推断不出兄弟姐妹的私钥；如果没有子链码，也无法推断出孙密钥</li><li>可以得到如下的推导公式：</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell">child_private_key == (parent_private_key + lefthand_hash_output) % G<br>child_public_key  == point( (parent_private_key + lefthand_hash_output) % G )<br>child_public_key  == point(child_private_key) == parent_public_key + point(lefthand_hash_output)<br></code></pre></td></tr></table></figure><ul><li><p>可以看到，子公钥的推导有两种方式，一个是通过私钥推导，一个是直接通过公钥推导</p></li><li><p>正如我们之前看到的，密钥衍生函数可以被用来创造密钥树上任何层级的子密钥，基于以下三个输入量：密钥，链码以及想要的子密钥的索引。</p><p>密钥以及链码这两个重要的部分被结合之后，就叫做</p><p><em>扩展密钥（extended key）</em></p><p>。术语“扩展密钥”也被认为是“可扩展的密钥”，因为这种密钥可以用来衍生子密钥。</p><ul><li>扩展密钥编码用的 Base58Check使用特殊的版本号，Base58编码字符前缀分别为“xprv”和“xpub”</li></ul></li></ul><center class="half"><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513936.(null)" srcset="/img/loading.gif" lazyload width="300"><img src="https://kwaj2xdt3y.feishu.cn/space/api/box/stream/download/asynccode/?code=MDYwZjYzODI5NTFjOThiYTQ3MzZiM2JhMjAyNWIxNTBfazRleGFLaGlDbFVMOHlsZzllb01uelhQVkJ3SUo5RnJfVG9rZW46Ym94Y256d2Z4M2ZhWWR1NDZmeEtiV2hJOHRlXzE2Mzc5OTcyMDk6MTYzODAwMDgwOV9WNA" srcset="/img/loading.gif" lazyload width="300"></center><ul><li>上面左图为常规衍生，直接使用父公钥衍生子公钥，这样推导的好处就是不用访问私钥，就能衍生扩展出子公钥，用于收款，可以用在安全性较弱的web服务器上<ul><li>但是这种常规的扩展方式存在的问题是，当一个攻击者得到父公钥和对应的链码时，他可以衍生扩展出之后所有的子公钥和对应链码，如果此时再获得子私钥，那么就可以推导出这个子私钥之后所有的私钥（孙私钥等），甚至可能会推导出父私钥</li></ul></li></ul><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">child_private_key == <span class="hljs-comment">(parent_private_key + lefthand_hash_output)</span> <span class="hljs-meta">%</span> G<br></code></pre></td></tr></table></figure><ul><li>右图为强化衍生，不使用父公钥，直接用父私钥 + 父链码 + 索引 作为输入，得到输出（这样就算子公钥和子链码暴露了，也不能推导出父私钥）<ul><li>简单来说，如果想利用xpub的便捷来衍生公钥的分支，又不想冒泄露链码的风险， 就该从强化父密钥，而不是常规父密钥衍生。最好的方式是，为了避免主密钥泄露，主密钥所衍生的第一层级的子密钥总是通过强化衍生得来。</li></ul></li></ul><h1 id="交易"><a class="markdownIt-Anchor" href="#交易"></a> 交易</h1><ul><li>比特币交易是比特币系统中最重要的部分。比特币中的其他一切都是为了确保交易可以被创建、在网络上传播、验证，并最终添加到全局交易分类账本（区块链）中。比特币交易的本质是数据结构，这些数据结构是对比特币交易参与者价值传递的编码。比特币区块链是一本全局复式记账总账簿，每个比特币交易都是在比特币区块链上的一个公开记录。</li><li>交易主要的功能就是实现比特币的转移，而其实现过程就用到了密码学技术。支付比特币时，比特币的当前所有者需要在交易中提交其公钥和签名（每次交易的签名都不同，但都由同一个私钥生成）。针对展示的公钥和签名，比特币网络中的所有人都可以验证该交易有效并予以接受，从而确认支付者对该交易中的比特币的所有权。</li><li>这一小节中，将介绍交易的基本数据结构，关注比特币交易过程的实现，并聚焦密码学技术的使用。</li></ul><h2 id="交易的输出"><a class="markdownIt-Anchor" href="#交易的输出"></a> 交易的输出</h2><p>每一笔比特币交易都会创造输出，并被比特币正本记录下来。几乎所有的输出，除了一个例外（见“数据输出操作符”（OP_RETURN）），都能创造称为UTXO的比特币块，然后被整个网络识别，供所有者在未来交易中使用。</p><p>交易输出包含两部分：</p><ul><li><p>一定量的比特币，面值为“聪”（satoshis） ，是最小的比特币单位；</p></li><li><p>确定花费输出所需条件的加密难题（cryptographic puzzle），这个加密难题也被称为锁定脚本(locking script), 见证脚本(witness script), 或脚本公钥 (scriptPubKey)。</p><ul><li>只有出示对应的解锁脚本，成功执行锁定脚本（相当于进行签名验证的过程），才能花费这笔输出</li></ul></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-string">&quot;vout&quot;</span>: [<br>  &#123;<br>    <span class="hljs-attr">&quot;value&quot;</span>: <span class="hljs-number">0.01500000</span>,<br>    <span class="hljs-attr">&quot;scriptPubKey&quot;</span>: <span class="hljs-string">&quot;OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG&quot;</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">&quot;value&quot;</span>: <span class="hljs-number">0.08450000</span>,<br>    <span class="hljs-attr">&quot;scriptPubKey&quot;</span>: <span class="hljs-string">&quot;OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG&quot;</span>,<br>  &#125;<br>]<br></code></pre></td></tr></table></figure><h2 id="交易的输入"><a class="markdownIt-Anchor" href="#交易的输入"></a> 交易的输入</h2><p>交易的输入包含四个元素：</p><ul><li><p>一个交易ID，引用包含将要消费的UTXO的交易</p></li><li><p>一个输出索引（vout），用于标识来自该交易的哪个UTXO被引用（第一个为零）</p></li><li><p>一个 scriptSig（解锁脚本），满足UTXO的消费条件，解锁用于支出</p></li><li><p>一个序列号，用于指定这笔输入的生效时间</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-string">&quot;vin&quot;</span>: [<br>  &#123;<br>    <span class="hljs-attr">&quot;txid&quot;</span>: <span class="hljs-string">&quot;7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18&quot;</span>,<br>    <span class="hljs-attr">&quot;vout&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">&quot;scriptSig&quot;</span> : <span class="hljs-string">&quot;3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf&quot;</span>,<br>    <span class="hljs-attr">&quot;sequence&quot;</span>: <span class="hljs-number">4294967295</span><br>  &#125;<br>]<br></code></pre></td></tr></table></figure><h2 id="数字签名"><a class="markdownIt-Anchor" href="#数字签名"></a> 数字签名</h2><p>在上述交易的输入中提到了一个关键元素解锁脚本，实际上这就是应用了椭圆曲线密码算法的数字签名。在比特币的ECDSA算法的实现中，被签名的“消息”是交易，或更确切地说是交易中特定数据子集的哈希值。签名密钥是用户的私钥，结果就是签名：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>i</mi><mi>g</mi><mo>=</mo><msub><mi>F</mi><mrow><mi>s</mi><mi>i</mi><mi>g</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>F</mi><mrow><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi></mrow></msub><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>d</mi><mi>A</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Sig = F_{sig}(F_{hash}(m), d_A)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8777699999999999em;vertical-align:-.19444em"></span><span class="mord mathdefault" style="margin-right:.05764em">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:.03588em">g</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.311664em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><ul><li><p><em>dA</em> 是签名私钥</p></li><li><p><em>m</em> 是交易（或其部分数据）</p></li><li><p><em>Fhash</em> 是散列函数</p></li><li><p><em>Fsig</em> 是签名算法</p></li><li><p><em>Sig</em> 是结果签名</p></li></ul><p>函数<em>Fsig</em> 产生由两个值组成的签名Sig，通常称为R和S：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>i</mi><mi>g</mi><mo>=</mo><mi mathvariant="normal">（</mi><mi>R</mi><mi mathvariant="normal">，</mi><mi>S</mi><mi mathvariant="normal">）</mi></mrow><annotation encoding="application/x-tex">Sig = （R，S）</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8777699999999999em;vertical-align:-.19444em"></span><span class="mord mathdefault" style="margin-right:.05764em">S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:.03588em">g</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord cjk_fallback">（</span><span class="mord mathdefault" style="margin-right:.00773em">R</span><span class="mord cjk_fallback">，</span><span class="mord mathdefault" style="margin-right:.05764em">S</span><span class="mord cjk_fallback">）</span></span></span></span></span></p><p>现在已经计算了两个值R和S，它们就使用一种称为<em>可分辨编码规则Distinguished Encoding Rules</em>或<em>DER</em>的国际标准编码方案，序列化为字节流，正如我们在交易输入的JSON字符串中看到的那样。</p><hr><p><strong>签名序列化（DER）</strong></p><p>我们再来之前在交易输入中展示的一个解锁脚本，其中以下DER编码签名：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">3045022100884</span>d<span class="hljs-number">142</span>d<span class="hljs-number">86652</span>a<span class="hljs-number">3</span>f<span class="hljs-number">47</span>ba<span class="hljs-number">4746</span>ec<span class="hljs-number">719</span>bbfbd<span class="hljs-number">040</span>a<span class="hljs-number">570</span>b<span class="hljs-number">1</span>deccbb<span class="hljs-number">6498</span><span class="hljs-keyword">c</span><span class="hljs-number">75</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>ae<span class="hljs-number">24</span>cb<span class="hljs-number">02204</span>b<span class="hljs-number">9</span>f<span class="hljs-number">039</span>ff<span class="hljs-number">08</span>df<span class="hljs-number">09</span>cbe<span class="hljs-number">9</span>f<span class="hljs-number">6</span>addac<span class="hljs-number">960298</span>cad<span class="hljs-number">530</span>a<span class="hljs-number">863</span>ea<span class="hljs-number">8</span>f<span class="hljs-number">53982</span><span class="hljs-keyword">c</span><span class="hljs-number">09</span>db<span class="hljs-number">8</span>f<span class="hljs-number">6e381301</span><br></code></pre></td></tr></table></figure><p>该签名是用户钱包生成的R和S值的序列化字节流，证明对应用户拥有授权花费该输出的私钥。 序列化格式包含以下9个元素：</p><ul><li><p><em>0x30</em>表示DER序列的开始</p></li><li><p><em>0x45</em> - 序列的长度（69字节）</p></li><li><p><em>0x02</em> - 一个整数值</p></li><li><p><em>0x21</em> - 整数的长度（33字节）</p></li><li><p><em>00884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb</em> - R值</p></li><li><p><em>0x02</em> - 接下来是一个整数</p></li><li><p><em>0x20</em> - 整数的长度（32字节）</p></li><li><p><em>4b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</em> - S值</p></li><li><p>后缀（<em>0x01</em>）指示使用的哈希的类型（SIGHASH_ALL）</p></li></ul><hr><p><strong>验证签名</strong></p><ul><li>要验证签名，必须有签名（<em>R</em>和<em>S</em>）、序列化交易和公钥（对应于用于创建签名的私钥）。本质上，签名的验证意味着“只有生成此公钥的私钥的所有者，才能在此交易上产生此签名。”</li><li>签名验证算法采用消息（交易或其部分的哈希值）、签名者的公钥和签名（R和S值），如果签名对该消息和公钥有效，则返回 TRUE 值。</li></ul><h2 id="交易脚本"><a class="markdownIt-Anchor" href="#交易脚本"></a> 交易脚本</h2><p>正如之前内容提到的，锁定脚本和解锁脚本正是组成数字签名和签名验证过程的关键数据。</p><ul><li>锁定脚本：锁定脚本是一个放置在交易输出上面的花费条件——它指定了今后花费这笔输出必须要满足的条件。 由于锁定脚本往往含有一个公钥或比特币地址（公钥哈希值），在历史上它曾被称为<em>脚本公钥scriptPubKey</em>。</li><li>解锁脚本：解锁脚本是这样一个脚本，它“解决”或满足由锁定脚本放置在输出上的条件，并允许使用输出。解锁脚本是每一笔比特币交易输入的一部分，而且往往含有一个由用户的比特币钱包（通过用户的私钥）生成的数字签名。由于解锁脚本常常包含一个数字签名，因此它曾被称作<em>脚本签名ScriptSig</em>。</li><li>当结合锁定脚本和解锁脚本，在堆栈中执行脚本，如果堆栈中最后剩余的结果为“TRUE”，表明解锁脚本中签名跟锁定脚本中的公钥哈希是相匹配的，即用于签名的私钥跟公钥是匹配的。其中，签名验证的这个验证操作正是锁定脚本中 “<strong>OP_CHECKSIG</strong>” 所执行的，即比对消息（交易或其部分的哈希值）、签名者的公钥和签名（R和S值）。</li></ul><hr><p><strong>脚本执行</strong></p><ul><li>在最初版本的比特币客户端中，解锁脚本和锁定脚本按顺序连起来执行。出于安全因素考虑，在2010年发生了改变，因为存在一个漏洞，允许格式错误的解锁脚本将数据推送到堆栈并损坏锁定脚本。而在当前的方案中，脚本是单独执行的，在两次执行之间传输堆栈，如下所述。<ul><li>首先，使用堆栈执行引擎执行解锁脚本。如果解锁脚本在执行过程中未报错（例如：没有留下“dangling”操作码），则复制主堆栈，并执行锁定脚本。如果从解锁脚本中复制而来的堆栈数据执行锁定脚本的结果为“TRUE&quot;，那么解锁脚本就成功地满足了锁定脚本所设置的条件，因此，该输入是一个能使用该UTXO的有效授权。如果合并脚本执行后的结果是”TRUE“以外的任何结果，输入都是无效的，因为它不能满足UTXO中所设置的使用该笔资金的条件。</li></ul></li></ul><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202111271513603.(null)" srcset="/img/loading.gif" lazyload alt="结合scriptSig和scriptPubKey执行脚本"></p><p class="note note-info">具体脚本在堆栈中的执行过程，可参考：<a target="_blank" rel="noopener" href="https://github.com/tianmingyun/MasterBitcoin2CN/blob/master/ch06.md#644-p2pkhpay-to-public-key-hash">P2PKH 脚本执行流程</a></p><h1 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h1><p>比特币系统中大量使用了密码学技术，例如使用椭圆曲线密码算法生成密钥和公钥，以及交易中的数字签名和验证，确保比特币的所有者在进行转账操作。密码学实现了比特币的许多有趣特性，包括去中心化信任和控制、所有权认证和基于密码学证明的安全模型。可以说，密码学是比特币实现的一大基石。</p><p class="note note-success">更多比特币知识可参考我的这个Github项目：<a target="_blank" rel="noopener" href="https://github.com/2017zhangyuxuan/Learn-Blockchain">比特币系统 C++ 实现</a></p><h1 id="参考资料附录"><a class="markdownIt-Anchor" href="#参考资料附录"></a> 参考资料附录</h1><p><a target="_blank" rel="noopener" href="https://github.com/tianmingyun/MasterBitcoin2CN">《精通比特币》中文电子书</a></p><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/21298725">比特币（地址、私钥）压缩与非压缩的区别</a></p><p><a target="_blank" rel="noopener" href="https://github.com/tianmingyun/MasterBitcoin2CN/blob/master/ch05.md#523-%E4%BB%8E%E5%8A%A9%E8%AE%B0%E8%AF%8D%E7%94%9F%E6%88%90%E7%A7%8D%E5%AD%90">HD分层钱包 种子生成过程</a></p><p><a target="_blank" rel="noopener" href="https://github.com/tianmingyun/MasterBitcoin2CN/blob/master/ch06.md#644-p2pkhpay-to-public-key-hash">P2PKH 脚本执行流程</a></p><p><a target="_blank" rel="noopener" href="https://bitcoin.stackexchange.com/questions/72657/signature-verification-in-python-using-compressed-public-key">Signature verification in python using compressed public key</a></p><p><a target="_blank" rel="noopener" href="https://medium.com/@bitaps.com/exploring-bitcoin-signing-the-p2pkh-input-b8b4d5c4809c">Exploring Bitcoin: signing the P2PKH input</a></p><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a560e0605ff2">比特币私钥，公钥和地址的关系</a></p><p><a target="_blank" rel="noopener" href="https://live.blockcypher.com/">在线搜索交易记录、区块信息（各种数字货币）</a></p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/">计算机知识</a> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/%E6%AF%94%E7%89%B9%E5%B8%81/">比特币</a> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/Bitcoin/">Bitcoin</a> <a class="hover-with-bg" href="/tags/ECDSA/">ECDSA</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/2021/12/13/2021-12/2021-12-13%20%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%85%AC%E9%92%A5%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95%E4%B8%8ESM2%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">椭圆曲线公钥恢复算法与SM2编程实现</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2021/11/13/2021-11/2021-11-13%20SM4/"><span class="hidden-mobile">SM4算法介绍与代码实现</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="waline"></div><script>Fluid.utils.loadComments("#waline",function(){Fluid.utils.createScript("https://lib.baomitu.com/waline/2.5.1/Waline.min.js",function(){var a=Object.assign({serverURL:"https://blog-api-cwpbgt9h8-2017zhangyuxuan.vercel.app",path:"window.location.pathname",placeholder:"期待地搓搓手~",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',avatar:"mp",avatarCDN:"https://seccdn.libravatar.org/avatar/",avatarForce:!1,wordLimit:0,pageSize:10,highlight:!0},{el:"#waline",path:window.location.pathname});new Waline(a),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{Fluid.plugins.initFancyBox("#waline .vcontent img:not(.vemoji)")})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><br></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">浙ICP备2022004380号-1 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011502005551" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备11011502005551号</span></a></span></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/local-search.js"></script><script src="/js/img-lazyload.js"></script><script src="https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js"></script><script src="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js"></script><script defer src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script defer src="/js/leancloud.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><link rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.15.6/katex.min.css"><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?41ea7ec25546b456fd8c769b77c5f7b8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/js/boot.js"></script></body></html>