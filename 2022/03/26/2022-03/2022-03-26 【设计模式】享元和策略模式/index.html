<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="本期带来的是享元模式（Flyweight）与策略模式（Strategy）的基本介绍。"><meta name="author" content="Zhang Yuxuan"><meta name="keywords" content=""><meta name="description" content="本期带来的是享元模式（Flyweight）与策略模式（Strategy）的基本介绍。"><meta property="og:type" content="article"><meta property="og:title" content="【设计模式】享元模式与策略模式"><meta property="og:url" content="https://2017zhangyuxuan.github.io/2022/03/26/2022-03/2022-03-26%20%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E4%BA%AB%E5%85%83%E5%92%8C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="本期带来的是享元模式（Flyweight）与策略模式（Strategy）的基本介绍。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281441718.jpeg"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281441858.jpeg"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281444593.jpeg"><meta property="article:published_time" content="2022-03-26T09:40:36.000Z"><meta property="article:modified_time" content="2022-03-28T06:51:33.708Z"><meta property="article:author" content="Zhang Yuxuan"><meta property="article:tag" content="设计模式"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281441718.jpeg"><title>【设计模式】享元模式与策略模式 - Hexo</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"2017zhangyuxuan.github.io",root:"/",version:"1.8.12",typing:{enable:!0,typeSpeed:40,cursorChar:"",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:"41ea7ec25546b456fd8c769b77c5f7b8",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"y5CeAktdcKSzcAmVadWC9kvO-gzGzoHsz",app_key:"6DumtsnWAqBVLRmOTnmYxXx6",server_url:"https://y5ceaktd.lc-cn-n1-shared.com"}},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>KingOfDark</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://cdn.jsdelivr.net/gh/2017zhangyuxuan/picture_backend@master//hexo_img/yourname6.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="【设计模式】享元模式与策略模式"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-03-26 17:40" pubdate>2022年3月26日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 11k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 36 分钟</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">【设计模式】享元模式与策略模式</h1><p class="note note-info">本文最后更新于：2022年3月28日 下午</p><div class="markdown-body"><h1 id="flyweight享元模式"><a class="markdownIt-Anchor" href="#flyweight享元模式"></a> Flyweight（享元）模式</h1><h2 id="1-意图"><a class="markdownIt-Anchor" href="#1-意图"></a> 1. 意图</h2><p>运用共享技术有效地支持大量细粒度的对象</p><h2 id="2-动机"><a class="markdownIt-Anchor" href="#2-动机"></a> 2. 动机</h2><p>Flyweight模式描述了如何共享对象，使得可以细粒度地使用它们而不需要高昂的代价。</p><p>Flyweight是一个共享对象，他可以同时在多个场景（context）中使用，并且在每个场景中flyweight都可以作为一个独立的对象——这一点与非共享对象的实例没有区别。flyweight不能对它所运行的场景做出任何假设，这里关键的概念是<strong>内部状态</strong>与<strong>外部状态</strong>之间的区别。内部状态存储于flyweight中，它包含了独立于flyweight场景的信息，这些信息使得flyweight可以被共享。而外部状态取决于flyweight场景，并根据场景而变化，因此不可共享。用户对象负责在必要的时候将外部状态传递给flyweight。</p><p>Flyweight模式对那些通常由于数量太大而难以用对象来表示的概念或实体进行建模。</p><h2 id="3-适用性"><a class="markdownIt-Anchor" href="#3-适用性"></a> 3. 适用性</h2><p>Flyweight模式的有效性很大程度上取决于如何使用它以及在何处使用它。当一下情况成立时，使用Flyweight模式：</p><ul><li>一个应用使用了大量的对象。</li><li>完全由于使用大量的对象造成很大的存储开销。</li><li>对象的大多数状态都可变为外部状态。</li><li>如果删除对象的外部状态，那么可以用相对较少的共享对象取代很对组对象</li><li>应用程序不依赖于对象标识。由于Flyweight对象可以被共享，因此概念上明显有别的对象，标识测试将返回真值。</li></ul><h2 id="4-结构"><a class="markdownIt-Anchor" href="#4-结构"></a> 4. 结构</h2><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281441718.jpeg" srcset="/img/loading.gif" lazyload alt="结构示意图"></p><p>下面对象图说明了如何共享flyweight</p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281441858.jpeg" srcset="/img/loading.gif" lazyload alt="对象图"></p><h2 id="5-参与者"><a class="markdownIt-Anchor" href="#5-参与者"></a> 5. 参与者</h2><ul><li>Flyweight（Glyph）<ul><li>描述一个接口，通过这个接口flyweght可以接受并作用于外部状态</li></ul></li><li>ConcreteFlyweight（character）<ul><li>实现Flyweight接口，并为内部状态（如果有的话）增加存储空间。ConcreteFlyweight对象必须是可共享的。它所存储的状态必须是内部的。即它必须独立于ConcreteFlyweight 对象的场景。</li></ul></li><li>UnsharedConcreteFlyweight（Row、Column）<ul><li>并非所有的Flyweight子类都需要被共享。Flyweight接口使共享成为可能，但它并不强制共享。在flyweight对象结构的某些层次，UnsharedConcreteFlyweight对象通常将ConcreteFlyweight对象作为子节点。</li></ul></li><li>FlyweightFactory<ul><li>创建并管理Flyweight对象</li><li>确保合理地共享Flyweight。当用户请求一个flyweight时，FlyweightFactory对象提供一个已创建的实例或创建一个（如果不存在的话）</li></ul></li><li>Client<ul><li>维持一个对Flyweight的引用</li><li>计算或存储一个（或多个）flyweight的外部状态</li></ul></li></ul><h2 id="6-协作"><a class="markdownIt-Anchor" href="#6-协作"></a> 6. 协作</h2><ul><li>flyweight执行时所需的状态必定是内部的或外部的。内部状态存储于ConcreteFlyweight对象中，而外部状态则是由Client对象存储或计算。当用户调用flyweight对象的操作时，将该状态传递给它。</li><li>用户不应该直接对ConcreteFlyweight类进行实例化，而只能从FlyweightFactory对象得到ConcreteFlyweight对象。这可以保证对它们适当地进行共享。</li></ul><h2 id="7-实现"><a class="markdownIt-Anchor" href="#7-实现"></a> 7. 实现</h2><p>在实现Flyweight模式时，应注意一下几点：</p><p>① 删除外部状态。该模式的可用性在很大程度上取决于是否容易识别外部状态并将它从共享对象中删除。</p><p>② 管理共享对象。 因为对象是共享的，用户不能直接对它进行实例化，所以FlyweightFactory来帮助用户查找某个特定的flyweight对象。共享还意味着某种形式的引用计数和垃圾回收，这样当一个flyweight不再使用时，可以回收它的存储空间。</p><h2 id="8-示例代码"><a class="markdownIt-Anchor" href="#8-示例代码"></a> 8. 示例代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Flyweight.h</span><br><span class="hljs-comment">// Created by 张宇轩 on 2022/3/26.</span><br><span class="hljs-comment">// Copyright (c) 2022 zhangyuxuan. All rights reserved.</span><br><span class="hljs-comment">// </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unordered_map&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> BEHAVIORALPATTERNDESIGN_FLYWEIGHT_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BEHAVIORALPATTERNDESIGN_FLYWEIGHT_H</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test_Flyweight</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-comment">// 棋子状态，坐标</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ChessPoint</span> &#123;</span><br>    <span class="hljs-keyword">int</span> x;<br>    <span class="hljs-keyword">int</span> y;<br>    <span class="hljs-built_in">ChessPoint</span>() = <span class="hljs-keyword">default</span>;<br>    <span class="hljs-built_in">ChessPoint</span>(<span class="hljs-keyword">int</span> x,<span class="hljs-keyword">int</span> y) : <span class="hljs-built_in">x</span>(x),<span class="hljs-built_in">y</span>(y) &#123;&#125;<br>    <span class="hljs-function">string <span class="hljs-title">to_string</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;(&quot;</span> + ::<span class="hljs-built_in">to_string</span>(x)+<span class="hljs-string">&quot;,&quot;</span> + ::<span class="hljs-built_in">to_string</span>(y)+<span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ChessPointHash</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ChessPoint&amp; point)</span> <span class="hljs-keyword">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> hash&lt;<span class="hljs-keyword">int</span>&gt;()(point.x + <span class="hljs-number">10</span> * point.y);<br>    &#125;<br>&#125;;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ChessPointEqual</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ChessPoint&amp; p1,<span class="hljs-keyword">const</span> ChessPoint&amp; p2 )</span> <span class="hljs-keyword">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (p1.x == p2.x &amp;&amp; p1.y == p2.y);<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 象棋棋子</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Chess</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Type</span> &#123;</span><br>        Red,<br>        Black,<br>        Board<br>    &#125;;<br>    <span class="hljs-built_in">Chess</span>(string name, Type type) :<span class="hljs-built_in">name</span>(name),<span class="hljs-built_in">type</span>(type) &#123;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">move</span><span class="hljs-params">(ChessPoint start, ChessPoint end)</span> </span>&#123;<br>        <span class="hljs-comment">// 棋盘越界</span><br>        <span class="hljs-keyword">if</span> (start.x &lt; <span class="hljs-number">0</span> || start.y &lt; <span class="hljs-number">0</span> || start.x &gt;= <span class="hljs-number">9</span> || start.y &gt;= <span class="hljs-number">10</span> ||<br>            end.x &lt;<span class="hljs-number">0</span> || end.y &lt; <span class="hljs-number">0</span> || end.x &gt;= <span class="hljs-number">9</span> || end.y &gt;= <span class="hljs-number">10</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-function">string <span class="hljs-title">get_name</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>    <span class="hljs-function">Type <span class="hljs-title">get_type</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> type;<br>    &#125;<br><br><span class="hljs-keyword">protected</span>:<br>    string name;<br>    Type type;<br>&#125;;<br><br><span class="hljs-comment">// 兵</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Soldier</span> :</span> <span class="hljs-keyword">public</span> Chess &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Soldier</span>(string name, Type type) : <span class="hljs-built_in">Chess</span>(name, type)  &#123;<br><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">move</span><span class="hljs-params">(ChessPoint start, ChessPoint end)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (!Chess::<span class="hljs-built_in">move</span>(start,end)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( (start.x == end.x &amp;&amp; start.y +<span class="hljs-number">1</span> == end.y) ||       <span class="hljs-comment">// 向上走</span><br>             (start.y == end.y &amp;&amp; (start.x+<span class="hljs-number">1</span> == end.x || start.x<span class="hljs-number">-1</span> == end.y)))&#123;      <span class="hljs-comment">// 左右走</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 车</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> :</span> <span class="hljs-keyword">public</span> Chess &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">move</span><span class="hljs-params">(ChessPoint start, ChessPoint end)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (!Chess::<span class="hljs-built_in">move</span>(start,end)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">// 车 没有多余的限制</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChessFactory</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// 如果不提前创建的话，如何根据传入的name，动态创建对应的类（不用if else 进行判断）？</span><br>    <span class="hljs-built_in">ChessFactory</span>() &#123;<br>        red_chess[<span class="hljs-string">&quot;兵&quot;</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Soldier</span>(<span class="hljs-string">&quot;兵&quot;</span>,Chess::Red);<br>        red_chess[<span class="hljs-string">&quot;车&quot;</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Soldier</span>(<span class="hljs-string">&quot;车&quot;</span>,Chess::Red);<br>        black_chess[<span class="hljs-string">&quot;兵&quot;</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Soldier</span>(<span class="hljs-string">&quot;兵&quot;</span>,Chess::Red);<br>        red_chess[<span class="hljs-string">&quot;车&quot;</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Soldier</span>(<span class="hljs-string">&quot;车&quot;</span>,Chess::Red);<br>    &#125;<br><br>    <span class="hljs-function">Chess* <span class="hljs-title">create_chess</span><span class="hljs-params">(string name, Chess::Type type)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (type == Chess::Type::Red) &#123;<br>            <span class="hljs-keyword">return</span> red_chess[name];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> black_chess[name];<br>        &#125;<br>    &#125;<br>    ~<span class="hljs-built_in">ChessFactory</span>() &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> iter : red_chess) &#123;<br>            <span class="hljs-keyword">delete</span> iter.second;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> iter : black_chess) &#123;<br>            <span class="hljs-keyword">delete</span> iter.second;<br>        &#125;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    unordered_map&lt;string, Chess*&gt; red_chess;<br>    unordered_map&lt;string, Chess*&gt; black_chess;<br>&#125;;<br><br><br><span class="hljs-comment">// 象棋棋盘，类比 UnsharedConcreteFlyweight</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChessBoard</span> :</span> <span class="hljs-keyword">public</span> Chess &#123;<br><span class="hljs-keyword">public</span> :<br>    <span class="hljs-built_in">ChessBoard</span>(string name, Type type, ChessFactory&amp; factory) : <span class="hljs-built_in">Chess</span>(name, type) &#123;<br>        <span class="hljs-comment">// 简单地做下初始化</span><br>        <span class="hljs-function">ChessPoint <span class="hljs-title">p1</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">4</span>)</span></span>;<br>        <span class="hljs-function">ChessPoint <span class="hljs-title">p2</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">8</span>)</span></span>;<br>        board[p1] = factory.<span class="hljs-built_in">create_chess</span>(<span class="hljs-string">&quot;兵&quot;</span>,Red);<br>        board[p2] = factory.<span class="hljs-built_in">create_chess</span>(<span class="hljs-string">&quot;车&quot;</span>,Red);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">move</span><span class="hljs-params">(ChessPoint start, ChessPoint end)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> start_iter = board.<span class="hljs-built_in">find</span>(start);<br>        <span class="hljs-keyword">if</span> (start_iter == board.<span class="hljs-built_in">end</span>()) &#123;        <span class="hljs-comment">// 起点没有棋子</span><br>            cout &lt;&lt; <span class="hljs-string">&quot;起点没有棋子！&quot;</span> &lt;&lt;endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">auto</span> end_iter = board.<span class="hljs-built_in">find</span>(end);<br>        <span class="hljs-keyword">if</span> (end_iter != board.<span class="hljs-built_in">end</span>() &amp;&amp;          <span class="hljs-comment">// 起点和终点的棋子颜色相同</span><br>            end_iter-&gt;second-&gt;<span class="hljs-built_in">get_type</span>() == start_iter-&gt;second-&gt;<span class="hljs-built_in">get_type</span>()) &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;起点和终点的棋子颜色相同&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">bool</span> flag = start_iter-&gt;second-&gt;<span class="hljs-built_in">move</span>(start,end);<br>        <span class="hljs-keyword">if</span> (flag) &#123;<br>            board[end] = start_iter-&gt;second;<br>            board.<span class="hljs-built_in">erase</span>(start_iter);<br>            cout &lt;&lt; <span class="hljs-string">&quot;棋子：&quot;</span> &lt;&lt; start_iter-&gt;second-&gt;<span class="hljs-built_in">get_name</span>() &lt;&lt;<br>                 <span class="hljs-string">&quot; 从&quot;</span> &lt;&lt; start.<span class="hljs-built_in">to_string</span>() &lt;&lt; <span class="hljs-string">&quot;到&quot;</span> &lt;&lt; end.<span class="hljs-built_in">to_string</span>() &lt;&lt;<span class="hljs-string">&quot; 移动成功&quot;</span> &lt;&lt; endl;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;棋子：&quot;</span> &lt;&lt; start_iter-&gt;second-&gt;<span class="hljs-built_in">get_name</span>() &lt;&lt;<br>             <span class="hljs-string">&quot; 从&quot;</span> &lt;&lt; start.<span class="hljs-built_in">to_string</span>() &lt;&lt; <span class="hljs-string">&quot;到&quot;</span> &lt;&lt; end.<span class="hljs-built_in">to_string</span>() &lt;&lt;<span class="hljs-string">&quot; 移动失败&quot;</span> &lt;&lt; endl;<br>        &#125;<br>        <span class="hljs-keyword">return</span> flag;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    unordered_map&lt;ChessPoint, Chess*, ChessPointHash, ChessPointEqual&gt; board;<br><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">//BEHAVIORALPATTERNDESIGN_FLYWEIGHT_H</span></span><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Flyweight.cpp</span><br><span class="hljs-comment">// Created by 张宇轩 on 2022/3/26.</span><br><span class="hljs-comment">// Copyright (c) 2022 zhangyuxuan. All rights reserved.</span><br><span class="hljs-comment">// </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;Flyweight.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test_Flyweight</span><span class="hljs-params">()</span> </span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;——————开始测试 Flyweight 模式——————&quot;</span> &lt;&lt; endl;<br>    ChessFactory factory;<br>    <span class="hljs-function">ChessBoard <span class="hljs-title">board</span><span class="hljs-params">(<span class="hljs-string">&quot;棋盘&quot;</span>,Chess::Board, factory)</span></span>;<br>    <span class="hljs-function">ChessPoint <span class="hljs-title">start1</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)</span>, <span class="hljs-title">start2</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">4</span>)</span>,<span class="hljs-title">end1</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">8</span>)</span>,<span class="hljs-title">end2</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)</span>, <span class="hljs-title">end3</span><span class="hljs-params">(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>)</span></span>;<br>    board.<span class="hljs-built_in">move</span>(start1,end1);<br>    board.<span class="hljs-built_in">move</span>(start2,end1);<br>    board.<span class="hljs-built_in">move</span>(start2,end2);<br>    board.<span class="hljs-built_in">move</span>(end2,end3);<br>    cout &lt;&lt; <span class="hljs-string">&quot;——————结束测试 Flyweight 模式——————&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; endl ;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-相关模式"><a class="markdownIt-Anchor" href="#9-相关模式"></a> 9. 相关模式</h2><p>Flyweight模式通常和Composite（组合）模式结合起来，用共享叶节点的有向无环图实现一个逻辑上的层次结构。</p><p>通常，最好用flyweight实现State和Strategy对象。</p><h1 id="strategy策略模式"><a class="markdownIt-Anchor" href="#strategy策略模式"></a> Strategy（策略）模式</h1><h2 id="1-意图-2"><a class="markdownIt-Anchor" href="#1-意图-2"></a> 1. 意图</h2><p>定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。本模式使得算法可独立于使用它的客户而变化</p><h2 id="2-别名"><a class="markdownIt-Anchor" href="#2-别名"></a> 2. 别名</h2><p>政策（policy）</p><h2 id="3-适用性-2"><a class="markdownIt-Anchor" href="#3-适用性-2"></a> 3. 适用性</h2><p>在以下情况下使用Strategy模式：</p><ul><li>许多相关的类仅仅是行为有异。“策略”提供了一种用多个行为中的一个行为来配置一个类的方法。</li><li>需要使用一个算法的不同变体。例如，你可能会定义一些反映不同的空间/时间权衡的算法。当这些变体实现为一个算法的类层次时，可以使用策略模式。</li><li>算法使用客户不应该知道的数据。可使用策略模式以避免暴露复杂的、与算法相关的数据结构</li><li>一个类定义了多种行为，并且这些行为在这个类的操作中以多个条件语句的形式出现。将相关的条件分支移入它们各自的Strategy类中以代替这些条件语句。</li></ul><h2 id="4-结构-2"><a class="markdownIt-Anchor" href="#4-结构-2"></a> 4. 结构</h2><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203281444593.jpeg" srcset="/img/loading.gif" lazyload alt="结构示意图"></p><h2 id="5-参与者-2"><a class="markdownIt-Anchor" href="#5-参与者-2"></a> 5. 参与者</h2><ul><li>Strategy（策略，如Compositor）<ul><li>定义所支持的算法的公共接口。Context使用这个接口来调用某ConcreteStrategy定义的算法</li></ul></li><li>ConcreteStrategy（具体策略，如SimpleCompositor、TeXCompositor、ArrayCompositor）<ul><li>以Strategy接口实现具体算法</li></ul></li><li>Context（上下文，如Composition）<ul><li>用一个ConcreteStrategy对象来配置</li><li>维护一个Strategy对象的引用</li><li>可定义一个接口来让Strategy访问它的数据</li></ul></li></ul><h2 id="6-协作-2"><a class="markdownIt-Anchor" href="#6-协作-2"></a> 6. 协作</h2><ul><li>Strategy和Context相互作用以实现选定的算法。当算法被调用时，Context可以将该算法所需要的所有数据都传递给该Strategy。或者，Context可以将自身作为一个参数传递给Strategy操作。这就让Strategy在需要时可以回调Context</li><li>Context将客户的请求转发给它的Strategy。客户通常创建并传递一个ConcreteStrategy对象给该Context，这样客户仅与Context交互。通常有一系列Strategy类可供客户从中选择。</li></ul><h2 id="7-实现-2"><a class="markdownIt-Anchor" href="#7-实现-2"></a> 7. 实现</h2><p>考虑下面的实现问题：</p><ol><li>定义Strategy和Context接口。</li></ol><ul><li>Strategy和Context接口必须使得ConcreteStrategy能够有效地访问它所需要的context中的任何数据，反之亦然。一种方法是让Context将数据放在参数中传递给Strategy，这使得Strategy和Context解耦，但Context也可能发送一些Strategy不需要的数据。</li><li>另一种方法是让Context将自身作为一个参数传递给Strategy，该Strategy再显式地想Context请求数据。或者Strategy可以存储对它的Context的引用。</li></ul><ol start="2"><li>将Strategy作为模板参数</li></ol><ul><li>在C++中，可利用模板机制用一个Strategy来配置一个类。然而这种方法仅当满足下面条件时才能使用：① 可以在编译时选择Strategy；② 不需要在运行时改变。在这种情况下，要被配置的类（如Context）被定义为一个以Strategy类作为参数的模板类。</li></ul><ol start="3"><li>使Strategy对象成为可选的</li></ol><ul><li>即使在不使用额外的Strategy对象的情况下，Context也有意义的话，那么它还可以被简化。Context在访问某Strategy前先检查它是否存在。如果有，就使用它；如果没有，那么Context执行缺省的行为。这种方法的好处是客户根本不需要处理Strategy对象，除非不喜欢缺省的行为。</li></ul><h2 id="8-示例代码-2"><a class="markdownIt-Anchor" href="#8-示例代码-2"></a> 8. 示例代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Strategy.h</span><br><span class="hljs-comment">// Created by 张宇轩 on 2022/3/26.</span><br><span class="hljs-comment">// Copyright (c) 2022 zhangyuxuan. All rights reserved.</span><br><span class="hljs-comment">// </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> BEHAVIORALPATTERNDESIGN_STRATEGY_H</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BEHAVIORALPATTERNDESIGN_STRATEGY_H</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @brief 策略模式，模拟两个实现</span><br><span class="hljs-comment"> * 1. 定义Strategy和Context接口，模拟场景为 输入框字符串的验证策略</span><br><span class="hljs-comment"> * 2. 将Strategy作为模板参数，可以参考STL中分配器，其中就运用了策略模式</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test_strategy</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-comment">// 校验器，对应于 Strategy 类，对字符串进行校验</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Validator</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">validate</span><span class="hljs-params">(string text)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (text.<span class="hljs-built_in">empty</span>()) &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;文本为空！&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    ~<span class="hljs-built_in">Validator</span>() = <span class="hljs-keyword">default</span>;<br>&#125;;<br><br><span class="hljs-comment">// 输入框 对应Context类，需要对输入的字符串进行校验，在不同场景下需要不同的验证策略</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InputText</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">InputText</span>() &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_validator</span><span class="hljs-params">(shared_ptr&lt;Validator&gt; validator)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>-&gt;validator = validator;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">input_text</span><span class="hljs-params">(string input)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (validator-&gt;<span class="hljs-built_in">validate</span>(input)) &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;输入：&quot;</span>&lt;&lt; input &lt;&lt;<span class="hljs-string">&quot;\t校验成功！&quot;</span> &lt;&lt; endl;<br>            text = input;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;输入：&quot;</span>&lt;&lt; input &lt;&lt;<span class="hljs-string">&quot;\t校验失败，请重新输入！&quot;</span> &lt;&lt; endl;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function">string <span class="hljs-title">get_text</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> text;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    string text;<br>    std::shared_ptr&lt;Validator&gt; validator;<br>&#125;;<br><br><span class="hljs-comment">// 数字校验器，校验策略为输入的必须是数字</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DigitValidator</span> :</span> <span class="hljs-keyword">public</span> Validator&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">validate</span><span class="hljs-params">(string text)</span> </span>&#123;<br>        <span class="hljs-keyword">bool</span> flag = Validator::<span class="hljs-built_in">validate</span>(text);<br>        <span class="hljs-keyword">if</span> (!flag) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> c : text) &#123;<br>            <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-string">&#x27;0&#x27;</span> || c &gt; <span class="hljs-string">&#x27;9&#x27;</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 字母校验器，校验策略为输入的必须是字母</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CharacterValidator</span> :</span> <span class="hljs-keyword">public</span> Validator &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">validate</span><span class="hljs-params">(string text)</span> </span>&#123;<br>        <span class="hljs-keyword">bool</span> flag = Validator::<span class="hljs-built_in">validate</span>(text);<br>        <span class="hljs-keyword">if</span> (!flag) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> c : text) &#123;<br>            <span class="hljs-keyword">if</span> (!( (c &gt;=<span class="hljs-string">&#x27;a&#x27;</span> &amp;&amp; c&lt;=<span class="hljs-string">&#x27;z&#x27;</span>) || (c&gt;=<span class="hljs-string">&#x27;A&#x27;</span> &amp;&amp; c&lt;=<span class="hljs-string">&#x27;Z&#x27;</span>)))&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 然后模拟将Strategy作为模板参数，类比STL容器和分配器的关系，做一个简单地示意</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Allocator</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">allocate</span><span class="hljs-params">()</span> </span>&#123;<br><br>    &#125;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Allocator</span>() = <span class="hljs-keyword">default</span>;<br>&#125;;<br><br><span class="hljs-comment">// 类比策略类，实现简单内存分批额策略</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleAllocator</span> :</span> <span class="hljs-keyword">public</span> Allocator&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">allocate</span><span class="hljs-params">()</span>  </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;实现简单内存分配策略&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 类比策略类，实现内存池分配策略</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PoolAllocator</span> :</span> <span class="hljs-keyword">public</span> Allocator &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">allocate</span><span class="hljs-params">()</span>  </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;实现内存池分配策略&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-keyword">class</span> <span class="hljs-title">Allocator</span>&gt;</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Container</span> &#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T val)</span> </span>&#123;<br>        allocator.<span class="hljs-built_in">allocate</span>();<br>        cout &lt;&lt; <span class="hljs-string">&quot;加入元素： &quot;</span> &lt;&lt; val &lt;&lt; endl;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    Allocator allocator;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">//BEHAVIORALPATTERNDESIGN_STRATEGY_H</span></span><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Strategy.cpp</span><br><span class="hljs-comment">// Created by 张宇轩 on 2022/3/26.</span><br><span class="hljs-comment">// Copyright (c) 2022 zhangyuxuan. All rights reserved.</span><br><span class="hljs-comment">// </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;Strategy.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test_strategy</span><span class="hljs-params">()</span> </span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;——————开始测试 Strategy 模式——————&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-comment">// 定义接口</span><br>    InputText it;<br>    it.<span class="hljs-built_in">set_validator</span>(make_shared&lt;DigitValidator&gt;());<br>    it.<span class="hljs-built_in">input_text</span>(<span class="hljs-string">&quot;1aaaa&quot;</span>);<br>    it.<span class="hljs-built_in">set_validator</span>(make_shared&lt;CharacterValidator&gt;());<br>    it.<span class="hljs-built_in">input_text</span>(<span class="hljs-string">&quot;aaaa&quot;</span>);<br><br>    <span class="hljs-comment">// 使用模板参数</span><br>    Container&lt;<span class="hljs-keyword">int</span>,SimpleAllocator&gt; container;<br>    container.<span class="hljs-built_in">push</span>(<span class="hljs-number">1</span>);<br>    Container&lt;<span class="hljs-keyword">int</span>,PoolAllocator&gt; container2;<br>    container2.<span class="hljs-built_in">push</span>(<span class="hljs-number">2</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;——————结束测试 Strategy 模式——————&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt;endl;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-相关模式-2"><a class="markdownIt-Anchor" href="#9-相关模式-2"></a> 9. 相关模式</h2><p>Flyweight：Strategy对象通常是很好的轻量级对象</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/">计算机知识</a> <a class="hover-with-bg" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/">编程技巧</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/2022/04/02/2022-04/2022-04-02%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">【设计模式】抽象工厂模式</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/03/20/2022-03/2022-03-20%20%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/"><span class="hidden-mobile">【设计模式】组合模式与装饰模式</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="waline"></div><script>Fluid.utils.loadComments("#waline",function(){Fluid.utils.createScript("https://cdn.jsdelivr.net/npm/@waline/client@1/dist/Waline.min.js",function(){var a=Object.assign({serverURL:"https://blog-api-cwpbgt9h8-2017zhangyuxuan.vercel.app",path:"window.location.pathname",placeholder:"期待地搓搓手~",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',avatar:"mp",avatarCDN:"https://seccdn.libravatar.org/avatar/",avatarForce:!1,wordLimit:0,pageSize:10,highlight:!0},{el:"#waline",path:window.location.pathname});new Waline(a),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{Fluid.plugins.initFancyBox("#waline .vcontent img:not(.vemoji)")})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><br></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">浙ICP备2022004380号-1 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011502005551" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备11011502005551号</span></a></span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/local-search.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?41ea7ec25546b456fd8c769b77c5f7b8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/js/boot.js"></script></body></html>