<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Zhang Yuxuan"><meta name="keywords" content=""><meta name="description" content="99%概率完成环境搭建，让天下没有搭建不了的环境！本期带来的是MIT6.828课程实验对应的xv6-riscv内核调试教程。"><meta property="og:type" content="article"><meta property="og:title" content="【99%环境搭建系列】xv6-riscv内核调试教程"><meta property="og:url" content="https://2017zhangyuxuan.github.io/2022/03/19/2022-03/2022-03-19%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%B3%BB%E5%88%97-xv6%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E6%95%99%E7%A8%8B/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="99%概率完成环境搭建，让天下没有搭建不了的环境！本期带来的是MIT6.828课程实验对应的xv6-riscv内核调试教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203201204176.jpeg"><meta property="article:published_time" content="2022-03-19T14:01:33.000Z"><meta property="article:modified_time" content="2023-12-17T09:07:50.570Z"><meta property="article:author" content="Zhang Yuxuan"><meta property="article:tag" content="xv6-riscv"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203201204176.jpeg"><title>【99%环境搭建系列】xv6-riscv内核调试教程 - Hexo</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"2017zhangyuxuan.github.io",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:40,cursorChar:"",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:"41ea7ec25546b456fd8c769b77c5f7b8",google:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"y5CeAktdcKSzcAmVadWC9kvO-gzGzoHsz",app_key:"6DumtsnWAqBVLRmOTnmYxXx6",server_url:"https://y5ceaktd.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!1},gtag:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>var _hmt;Fluid.ctx.dnt||(_hmt=_hmt||[],function(){var t=document.createElement("script"),e=(t.src="https://hm.baidu.com/hm.js?41ea7ec25546b456fd8c769b77c5f7b8",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}())</script><meta name="generator" content="Hexo 7.0.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>KingOfDark</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/hexo_img/yourname6.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="【99%环境搭建系列】xv6-riscv内核调试教程"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-03-19 22:01" pubdate>2022年3月19日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i>2.7k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i>9 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">【99%环境搭建系列】xv6-riscv内核调试教程</h1><p id="updated-time" class="note note-info">本文最后更新于：2023年12月17日 下午</p><div class="markdown-body"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在上《操作系统高级课程》，做的实验是MIT6.828的课程实验，在一个简易操作系统内核XV6上进行调试开发。后续我也会写一些介绍操作系统的文章。</p><p>关于XV6，这是MIT开发的一个教学目的的操作系统。<em>XV6</em>是在x86处理器上(x即指x86)用ANSI标准C重新实现的Unix第六版(Uni<em>x V6</em>，通常直接被称为V6)。并且MIT6.828这门关于操作系统的课程也是广受好评的，也推荐大家去学习。</p><p>这里再贴出一份相关的资源清单（不要再说找不到学习资源了而不学了~）：</p><ul><li>课程网站：<a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2020">https://pdos.csail.mit.edu/6.828/2020</a></li><li>xv6 官网安装教程：<a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2020/tools.html">https://pdos.csail.mit.edu/6.828/2020/tools.html</a></li><li>北大课程提示：<a target="_blank" rel="noopener" href="https://github.com/FrankZn/xv6-pku-hints">https://github.com/FrankZn/xv6-pku-hints</a></li><li>xv6-book中文版：<a target="_blank" rel="noopener" href="https://github.com/FrankZn/xv6-riscv-book-Chinese">https://github.com/FrankZn/xv6-riscv-book-Chinese</a></li><li>中文字幕视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19k4y1C7kA">6.S081 &#x2F; Fall 2020 麻省理工操作系统 - 2020 年秋季</a></li><li>实验代码参考：<a target="_blank" rel="noopener" href="https://home.cnblogs.com/u/weijunji/">https://home.cnblogs.com/u/weijunji/</a></li></ul><hr><p>回归主题，这次文章的来由就是实现虚拟机上实现gdb调试xv6。一开始因为只下载了内核的代码，所以只能进行编译运行，使用自带的gdb出现各种问题，后来发现是没有安装相应的编译工具。但是实际安装起来却花费了我好大一番功夫，所以特此记录，帮助后来人减少弯路。</p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200908096.(null)" srcset="/img/loading.gif" lazyload alt="报错信息1"></p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200908937.(null)" srcset="/img/loading.gif" lazyload alt="报错信息2"></p><p>再提一下我的机器环境：</p><ul><li>宿主机操作系统：Win10</li><li>虚拟机：Ubuntu20.04</li></ul><h1 id="追记"><a href="#追记" class="headerlink" title="追记"></a>追记</h1><p>后来经过指点，发现根本不需要下面riscv-gnu-toolchain 安装这一步骤，可以跳过那部分（其实那部分操作相当于是自己手动进行编译了，但实际上只需要用到编译好的工具程序即可）。</p><p>话不多说，直接上教程。</p><ol><li>首先可以根据官网教程安装，也就是执行下面这条命令，安装相关工具：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install git build-essential gdb-multiarch qemu-system-misc gcc-riscv64-linux-gnu binutils-riscv64-linux-gnu <br></code></pre></td></tr></table></figure><ol start="2"><li>然后再克隆实验代码</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone git://g.csail.mit.edu/xv6-labs-2020<br></code></pre></td></tr></table></figure><ol start="3"><li>切换分支，并进行编译</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout util<br>make qemu<br></code></pre></td></tr></table></figure><p>如果出现类似下面的界面，则表明安装成功</p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202204082125043.png" srcset="/img/loading.gif" lazyload alt="xv6内核运行截图"></p><ol start="4"><li>按ctrl + a + x 退出内核运行，在启动make qemu-gdb</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make qemu-gdb<br></code></pre></td></tr></table></figure><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202204082133201.png" srcset="/img/loading.gif" lazyload alt="make qemu-gdb运行结果"></p><ol start="5"><li>然后打开另一个中断窗口，直接执行gdb的话，会出现下面的提示</li></ol><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202204082134470.png" srcset="/img/loading.gif" lazyload alt="提示"></p><ol start="6"><li>按照提示，在<code>~/.gdbinit</code>文件中加入 <code>set auto-load safe-path /</code></li><li>然后执行<code>gdb-multiarch</code>，看到出现类似下面的界面，就表示成功了，接下里就是愉快的调试时间了，可以参考下文的GDB调试内容。</li></ol><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202204082134187.png" srcset="/img/loading.gif" lazyload alt="执行成功"></p><h1 id="riscv-gnu-toolchain-安装"><a href="#riscv-gnu-toolchain-安装" class="headerlink" title="riscv-gnu-toolchain 安装"></a>riscv-gnu-toolchain 安装</h1><p>根据官网上的教程安装，发现虚拟机连不上外网（这里还尝试一番功夫，没能成功），所以看到这篇文章，<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35990574/article/details/110006307">riscv-gnu-toolchain工具链下载安装_roockiet的博客</a><sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[riscv-gnu-toolchain工具链下载安装_roockiet的博客](https://blog.csdn.net/qq_35990574/article/details/110006307)">[1]</span></a></sup></p><p>使用gitee上的镜像进行下载，需要执行的命令大体如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-comment"># 安装编译需要的一些依赖</span><br>sudo apt<span class="hljs-literal">-get</span> install autoconf automake autotools<span class="hljs-literal">-dev</span> <span class="hljs-built_in">curl</span> libmpc<span class="hljs-literal">-dev</span> libmpfr<span class="hljs-literal">-dev</span> libgmp<span class="hljs-literal">-dev</span> gawk <span class="hljs-built_in">build-essential</span> bison flex texinfo gperf libtool patchutils bc zlib1g<span class="hljs-literal">-dev</span> libexpat<span class="hljs-literal">-dev</span><br><br><span class="hljs-comment"># 克隆工具仓库</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-gnu-toolchain</span>.git<br><br><span class="hljs-comment"># 进入目录</span><br><span class="hljs-built_in">cd</span> riscv<span class="hljs-literal">-gnu-toolchain</span> <br><br><span class="hljs-comment"># 手动克隆其他仓库，下载比较耗时，耐心等待吧</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-binutils-gdb</span>.git riscv<span class="hljs-literal">-binutils</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-dejagnu</span>.git riscv<span class="hljs-literal">-dejagnu</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-gcc</span>.git riscv<span class="hljs-literal">-gcc</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-binutils-gdb</span>.git riscv<span class="hljs-literal">-gdb</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-glibc</span>.git riscv<span class="hljs-literal">-glibc</span><br>git clone https://gitee.com/mirrors/riscv<span class="hljs-literal">-newlib</span>.git riscv<span class="hljs-literal">-newlib</span><br><br><span class="hljs-comment"># 这个qemu目录，后面好像没有用到，可以把这个目录给去了，如果担心，那就也一并下载吧</span><br>git clone https://gitee.com/mirrors/qemu.git qemu<br><br><span class="hljs-comment"># 所有仓库下载完成，开始编译</span><br>./configure <span class="hljs-literal">--prefix</span>=/usr/local  <span class="hljs-comment">#（选择安装目录，请确保对应的目录有足够大的容量，算上下载的仓库大约20G）</span><br>sudo make<br><span class="hljs-comment"># 这样编译大约需要 1 ~ 2 小时</span><br></code></pre></td></tr></table></figure><hr><p>注意这个riscv-gnu-toolchain所有的仓库都克隆下来后，并且直接执行make安装的话，耗时较久，估计有1~2小时，最后大约有18G（我是安装在了&#x2F;opt&#x2F;bin目录下），所以一定要确保对应分区的容量足够，不然就会因为容量不够而写失败（都是血淋淋的教训啊，看到下图根目录的挂载点了吗，之前就是因为安装在根目录对应的分区下，导致容量空间直接满了。。）。</p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203192203252.(null)" srcset="/img/loading.gif" lazyload alt="查看磁盘分区使用情况"></p><p>如果为了节省空间和时间，可以只尝试下面的配置方式，只安装riscv64-unknown-elf-gcc，参考这篇文章，<a target="_blank" rel="noopener" href="https://blog.csdn.net/weiqi7777/article/details/88045720">riscv各种版本gcc工具链编译与安装_weiqi7777的博客-CSDN博客_riscv编译器</a><sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[riscv各种版本gcc工具链编译与安装_weiqi7777的博客-CSDN博客_riscv编译器](https://blog.csdn.net/weiqi7777/article/details/88045720)">[2]</span></a></sup></p><p>因为后面调试时只用到了riscv64-unknown-elf-gdb，所以我猜测只需要安装对应gcc工具即可，不过我自已没有尝试过可不可行，所以还是交由各位看官自行决定。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Shell">../configure --prefix=/opt/riscv64 --with-arch=rv64imc --with-abi=lp64<br>make<br></code></pre></td></tr></table></figure><h1 id="GDB调试"><a href="#GDB调试" class="headerlink" title="GDB调试"></a>GDB调试</h1><ol><li>首先在一个窗口上执行：</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make qemu-gdb</span><br></code></pre></td></tr></table></figure><ol start="2"><li>然后打开另一个窗口，执行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">riscv64-unknown-elf-gdb kernel/kernel<br></code></pre></td></tr></table></figure><ol start="3"><li>然后可以看到进入了gdb界面，接着远程连接上一个窗口的gdb，执行下面的命令：</li></ol><p><code>target remote localhost:26000</code> （这里的26000填上一个窗口的端口号）</p><ol start="4"><li>连接成功之后，显示如下：</li></ol><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200909360.(null)" srcset="/img/loading.gif" lazyload alt="远程连接程序"></p><ol start="5"><li>然后把自己编译好的用户程序加载进来，也就是user目录下的文件<code>file user/_find</code></li></ol><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200909713.(null)" srcset="/img/loading.gif" lazyload alt="加载要调试的编译文件"></p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200909785.(null)" srcset="/img/loading.gif" lazyload alt="设置断点并执行"></p><ol start="6"><li>然后设置好断点，就可以按下 c 让程序运行到断点处，再返回上个窗口，执行对应命令，就可以看到程序暂停住了，返回gdb调试程序窗口，也能看到当前暂停的地方就是刚刚设置的断点处。</li></ol><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200909251.(null)" srcset="/img/loading.gif" lazyload alt="远程内核开始运行"></p><p><img src="https://kingofdark-blog.oss-cn-beijing.aliyuncs.com/picture_backend/picture_backend/img/202203200910116.(null)" srcset="/img/loading.gif" lazyload alt="gdb查看当前断点"></p><ol start="7"><li>之后就是痛苦地愉快地调试bug啦~有关gdb调试技巧，还可以参考我之前写的这篇文章，<a target="_blank" rel="noopener" href="http://gg.gg/y7c2n">GDB调试学习</a>。</li></ol><h1 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h1><p>这次安装过程中遇到两个坑，一个是在克隆仓库的时候，虚拟机无法访问外网，一个是安装riscv编译工具时，分区的容量不够了，这里就简单地做个记录。</p><h2 id="虚拟机网络配置"><a href="#虚拟机网络配置" class="headerlink" title="虚拟机网络配置"></a>虚拟机网络配置</h2><p>一开始的需求是实现虚拟机共享主机的VPN，也能够访问外网，参考了这篇文章，<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6c7abd4adc9b">Ubuntu虚拟机共享主机VPN（适用于NAT或桥接）</a><sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Ubuntu虚拟机共享主机VPN（适用于NAT或桥接）](https://www.jianshu.com/p/6c7abd4adc9b)">[3]</span></a></sup></p><p>尝试之后，报错代理服务器错误，正常的国内网页无法访问了。因为这个时候我用的是NAT模式，所以就想要尝试用桥接模式再试一下。</p><p>参考这里的视频教程 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ji4y1772Z?from=search&seid=5722489325382065130&spm_id_from=333.337.0.0">VMware网络选择和ubuntu 20_04 网络配置教程</a><sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="[VMware网络选择和ubuntu 20_04 网络配置教程](https://www.bilibili.com/video/BV1ji4y1772Z?from=search&seid=5722489325382065130&spm_id_from=333.337.0.0)">[4]</span></a></sup>，</p><p>配置静态IP的方式，我之前也提到过<a target="_blank" rel="noopener" href="http://gg.gg/y7c4c">【99%环境搭建系列】云计算管理平台Devstack安装</a>，后来虽然国内网络能够正常访问了，但是外网还是不行。</p><p>后来尝试很久还是没能成功，最后也就作罢了。既然外网访问不了，那就找国内镜像吧，幸运的是这条路走通了。</p><hr><p>最后没有实现需求，我想可能还是自己对网络的了解还是太粗浅了，日后一定要再恶补一下。不过借此机会，也了解学习了下VPN、桥接模式、NAT模式的概念，这里做个简单总结吧。</p><p>VPN：Vitrual Private Network，简单来说就是通信双方之间的数据进行了加密。更多内容参考 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1KY411t75D?from=search&seid=9126546184192701202&spm_id_from=333.337.0.0">VPN概念，技术原理和误区_哔哩哔哩_bilibili</a><sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="[VPN概念，技术原理和误区_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1KY411t75D?from=search&seid=9126546184192701202&spm_id_from=333.337.0.0)">[5]</span></a></sup></p><p>桥接模式：虚拟机使用宿主机的真实网卡，宿主机和虚拟机在相同的公网IP段下。</p><p>NAT模式：虚拟机和宿主机使用同一个虚拟网卡，从而实现在同一个局域网网段下，比如192.168.17.0 &#x2F; 24。</p><h2 id="ubuntu添加磁盘分区"><a href="#ubuntu添加磁盘分区" class="headerlink" title="ubuntu添加磁盘分区"></a>ubuntu添加磁盘分区</h2><p>还有一个坑就是在编译安装的时候，磁盘分区容量不够了。所以这里在演示一下如何给linux虚拟机添加磁盘分区。</p><ol><li>首先在VMware -&gt; 虚拟机选项 -&gt; 管理，选择扩展，添加想要增加的分区容量。（注意需要关闭虚拟机进行设置)</li><li>此时是还无法使用新增容量的，需要在虚拟机上添加分区，并挂载某一目录。那么首先登陆虚拟机，添加分区。</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-comment"># 列出所有设备，找到 type 类型为 disk 的设备名称</span><br>lsblk<br><br><span class="hljs-comment"># fdisk 适合MBR分区 </span><br>fdisk /dev/sda <span class="hljs-comment"># 这里的设备名称就是上面找到的设备名称</span><br><br><span class="hljs-comment"># 然后按 n ， 新增分区，选择一个区号，一路回车，最后 w 写入 </span><br><span class="hljs-comment"># 更详细的教程可以参考 https://www.cnblogs.com/rootshaw/p/12895022.html</span><br></code></pre></td></tr></table></figure><ol start="3"><li><p>添加好分区之后，就是格式化 <code>sudo mkfs.ext4 /dev/sda3</code> (设备名换成刚刚新增的分区)</p></li><li><p>然后就是挂载目录<code>sudo mount /dev/sda3 /opt/bin</code>（选择自己需要挂载的目录）</p></li><li><p>使用<code>df -h</code> 可以看是否挂载成功。挂载成功之后就可以使用该分区了。</p></li><li><p>上面的挂载，每次重启后都需要手动重新设置，所以这里再实现开机自动挂载，其实就是往配置文件<code>/etc/fstab</code> 里写配置，格式如下：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">分区/设备名     要挂载的目录     文件系统类型     defaults        0       0<br>/dev/sda3   /opt/bin   ext4   defaults 0   0<br></code></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>至此，折腾了我快一星期，总计耗时约10小时的调试环境安装之旅终于落下了帷幕。此时此刻我的心情是复杂的，一方面是为自己的无能而流泪（一个简单的调试环境搭建弄了这么久），兜兜转转这么久，也还只是完成了调试前的准备工作，查bug还在后头呢。另一方面也是一种释然，至少我没有半途而废，虽然过程坎坷，但我终究还是来到了终点。或许一开始我可以尝试用print输出来调试，但是我知道这种调试方式终究走不远，因为真正出问题的时候，是没有办法通过实时输出来进行调试的。所以这次使用gdb来调试内核，是一个千载难逢的机会，我不该错过。</p><hr><p><em>缓慢的、持久的、有纪律的努力，最终会导致令人难以置信的结果。</em></p><p><em>每当我无法忍受日常生活时，我就提醒自己，没有什么比每天坚持做下去更重要了。虽然我很难看到未来会怎样，但我知道持久性具有强大的威力，就像一句古老格言说的“继续去做”（keep doing）。</em></p><p>——<a target="_blank" rel="noopener" href="https://www.collaborativefund.com/blog/lessons-from-the-sea/">《大海教给我的》</a></p><section class="footnotes"><h1>备注/参考</h1><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35990574/article/details/110006307">riscv-gnu-toolchain工具链下载安装_roockiet的博客</a> <a href="#fnref:1" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://blog.csdn.net/weiqi7777/article/details/88045720">riscv各种版本gcc工具链编译与安装_weiqi7777的博客-CSDN博客_riscv编译器</a> <a href="#fnref:2" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6c7abd4adc9b">Ubuntu虚拟机共享主机VPN（适用于NAT或桥接）</a> <a href="#fnref:3" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ji4y1772Z?from=search&seid=5722489325382065130&spm_id_from=333.337.0.0">VMware网络选择和ubuntu 20_04 网络配置教程</a> <a href="#fnref:4" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1KY411t75D?from=search&seid=9126546184192701202&spm_id_from=333.337.0.0">VPN概念，技术原理和误区_哔哩哔哩_bilibili</a> <a href="#fnref:5" rev="footnote" class="footnote-backref">↩</a></span></span></li></ol></div></section></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/" class="category-chain-item">计算机知识</a> <span>></span> <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%B3%BB%E5%88%97/" class="category-chain-item">环境搭建系列</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/xv6-riscv/" class="print-no-link">#xv6-riscv</a></div></div><div class="license-box my-3"><div class="license-title"><div>【99%环境搭建系列】xv6-riscv内核调试教程</div><div>https://2017zhangyuxuan.github.io/2022/03/19/2022-03/2022-03-19 环境搭建系列-xv6内核调试教程/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Zhang Yuxuan</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年3月19日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/03/20/2022-03/2022-03-20%20%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/" title="【设计模式】组合模式与装饰模式"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">【设计模式】组合模式与装饰模式</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/03/12/2022-03/2022-03-12%20Git%E6%8C%87%E5%8D%97/" title="Git指南"><span class="hidden-mobile">Git指南</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="waline"></div><script>Fluid.utils.loadComments("#waline",function(){Fluid.utils.createCssLink("https://lib.baomitu.com/waline/2.5.1/waline.min.css"),Fluid.utils.createScript("https://lib.baomitu.com/waline/2.5.1/waline.min.js",function(){var i=Object.assign({serverURL:"https://blog-api-cwpbgt9h8-2017zhangyuxuan.vercel.app",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10,placeholder:"期待地搓搓手~",avatar:"mp",avatarCDN:"https://seccdn.libravatar.org/avatar/",avatarForce:!1,highlight:!0},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">浙ICP备2022004380号-1 </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011502005551" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"> <span>京公网安备11011502005551号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>